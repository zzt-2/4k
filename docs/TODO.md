# 激光通信上位机 - 待办事项清单

> 最后更新：2025-12-30
>
> 状态说明：✅ 已完成 | ⏳ 进行中 | ❌ 未开始

---

## 一、已完成功能

### 发送端

| 序号 | 功能模块   | 功能项       | 状态 | 备注                           |
| ---- | ---------- | ------------ | ---- | ------------------------------ |
| 1.1  | 数据源选择 | 摄像头采集   | ✅   | `useCamera.ts` 已实现          |
| 1.2  |            | 视频文件读取 | ✅   | `useVideoFileSource.ts` 已实现 |
| 2.1  | 图像预览   | 发送画面显示 | ✅   | `CameraPreview.vue` 已实现     |
| 4.1  | 传输控制   | 开始发送     | ✅   | 通过网络连接发送 H.265 编码帧  |
| 4.2  |            | 停止发送     | ✅   | 支持停止采集和发送             |

### 接收端

| 序号 | 功能模块 | 功能项       | 状态 | 备注                                 |
| ---- | -------- | ------------ | ---- | ------------------------------------ |
| 5.1  | 图像显示 | 接收画面显示 | ✅   | `RemoteVideoDisplay.vue` + H.265解码 |
| 8.1  | 传输控制 | 开始接收     | ✅   | 可接收和解码视频流                   |
| 8.2  |          | 停止接收     | ✅   | 支持断开连接停止接收                 |

### 通用功能

| 序号 | 功能模块 | 功能项       | 状态 | 备注                             |
| ---- | -------- | ------------ | ---- | -------------------------------- |
| 9.1  | 模式选择 | 仅发送模式   | ✅   | 模式切换已实现                   |
| 9.2  |          | 仅接收模式   | ✅   | 模式切换已实现                   |
| 9.3  |          | 收发模式     | ✅   | 回环测试模式已实现               |
| 10.1 | 网络配置 | 下位机IP配置 | ✅   | `StreamConfiguration.vue` 已实现 |
| 10.2 |          | 端口配置     | ✅   | 支持本地/远程端口配置            |

### 核心模块

| 模块         | 状态 | 备注                                               |
| ------------ | ---- | -------------------------------------------------- |
| UDP 网络连接 | ✅   | `udpConnection.ts` 支持自动分片                    |
| TCP 网络连接 | ✅   | `tcpClientConnection.ts`, `tcpServerConnection.ts` |
| 连接管理器   | ✅   | `connectionManager.ts` 统一管理连接                |
| H.265 编码   | ✅   | `useH265Encoder.ts` WebCodecs API                  |
| H.265 解码   | ✅   | `useH265Decoder.ts` WebCodecs API                  |

---

## 二、待办功能

### 发送端（高优先级）

| 序号 | 功能模块   | 功能项         | 状态 | 描述                          | 优先级 |
| ---- | ---------- | -------------- | ---- | ----------------------------- | ------ |
| 1.3  | 数据源选择 | 图像文件读取   | ❌   | 选择本地图像文件进行发送      | 中     |
| 3.1  | 参数控制   | 调制方式设置   | ❌   | 设置 RZ-OOK / PPM 调制方式    | 高     |
| 3.2  |            | 编译码方式设置 | ❌   | 选择 RS / LDPC 编译码方式     | 高     |
| 3.3  |            | 速率模式设置   | ❌   | 设置通信速率档位（高速/低速） | 高     |
| 3.4  |            | 发送控制帧     | ❌   | 将参数配置下发至下位机        | 高     |

### 接收端（高优先级）

| 序号 | 功能模块     | 功能项         | 状态 | 描述                   | 优先级 |
| ---- | ------------ | -------------- | ---- | ---------------------- | ------ |
| 6.1  | 统计数据显示 | 误码率显示     | ❌   | 实时显示当前误码率     | 高     |
| 6.2  |              | 信息速率显示   | ❌   | 实时显示当前通信速率   | 高     |
| 6.3  |              | 调制方式显示   | ❌   | 显示当前调制方式       | 中     |
| 6.4  |              | 编译码方式显示 | ❌   | 显示当前编译码方式     | 中     |
| 7.1  | 参数控制     | 调制方式设置   | ❌   | 设置接收端调制方式     | 高     |
| 7.2  |              | 编译码方式设置 | ❌   | 设置接收端编译码方式   | 高     |
| 7.3  |              | 速率模式设置   | ❌   | 设置接收端速率模式     | 高     |
| 7.4  |              | 发送控制帧     | ❌   | 将参数配置下发至下位机 | 高     |

### 通用功能

| 序号 | 功能模块 | 功能项       | 状态 | 描述                   | 优先级 |
| ---- | -------- | ------------ | ---- | ---------------------- | ------ |
| 10.3 | 网络配置 | 连接状态显示 | ⏳   | 显示与下位机的连接状态 | 中     |
| 11.1 | 数据存储 | 接收数据保存 | ❌   | 保存接收到的图像/视频  | 低     |
| 11.2 |          | 统计数据导出 | ❌   | 导出统计数据记录       | 低     |

---

## 三、通信协议实现

### 发送帧格式

| 帧类型     | 字段       | 实现状态 | 备注                             |
| ---------- | ---------- | -------- | -------------------------------- |
| **控制帧** | 调制方式   | ❌       | RZ-OOK / PPM 选择                |
|            | 编译码方式 | ❌       | RS(255,223) / LDPC(8176,7154) 等 |
|            | 速率模式   | ❌       | 高速/低速档位                    |
| **数据帧** | 视频流数据 | ✅       | 编码后的图像/视频数据            |

### 接收帧格式

| 帧类型     | 字段       | 实现状态 | 备注                  |
| ---------- | ---------- | -------- | --------------------- |
| **统计帧** | 误码率     | ❌       | 实时误码率            |
|            | 信息速率   | ❌       | 当前通信速率          |
|            | 调制方式   | ❌       | 当前调制方式          |
|            | 编译码方式 | ❌       | 当前编译码方式        |
| **数据帧** | 视频流数据 | ✅       | 接收到的图像/视频数据 |

---

## 四、非功能性需求

| 类别   | 需求                         | 实现状态 | 备注               |
| ------ | ---------------------------- | -------- | ------------------ |
| 性能   | 视频流至少满足1080P实时传输  | ⏳       | 需进一步测试和优化 |
| 实时性 | 统计数据实时刷新显示         | ❌       | 待实现统计数据模块 |
| 可靠性 | 网络断开后自动重连           | ❌       | 需实现断线重连机制 |
| 易用性 | 参数可保存，下次启动自动加载 | ❌       | 需实现配置持久化   |

---

## 五、建议开发顺序

### 第一阶段：核心参数控制（高优先级）

1. **控制帧协议定义**
   - 定义控制帧的数据结构和二进制格式
   - 包含：调制方式、编译码方式、速率模式

2. **发送端参数控制界面**
   - 添加调制方式选择器（RZ-OOK / PPM）
   - 添加编译码方式选择器（RS / LDPC）
   - 添加速率模式选择器（高速 / 低速）
   - 实现发送控制帧功能

3. **接收端参数控制界面**
   - 同发送端，添加参数配置UI
   - 实现接收端控制帧下发

### 第二阶段：统计数据显示

4. **统计帧协议解析**
   - 定义统计帧的数据结构
   - 实现统计帧的接收和解析

5. **统计数据显示面板**
   - 创建 `StatisticsPanel.vue` 组件
   - 实时显示误码率、信息速率、调制方式、编译码方式

### 第三阶段：辅助功能

6. **图像文件支持**
   - 实现静态图像文件读取
   - 支持发送单张图像

7. **连接状态显示优化**
   - 完善连接状态指示
   - 添加断线重连机制

8. **数据存储功能**
   - 实现接收数据保存
   - 实现统计数据导出

9. **参数持久化**
   - 使用 localStorage 或 SQLite 保存配置
   - 启动时自动加载上次配置

---

## 六、技术债务

| 问题描述                          | 优先级 | 状态 |
| --------------------------------- | ------ | ---- |
| StatusPanel 组件功能基本为空      | 中     | ❌   |
| 缺少与下位机的完整协议文档        | 高     | ❌   |
| 缺少单元测试                      | 低     | ❌   |
| 编码器配置不够灵活（硬编码H.265） | 低     | ⏳   |

---

## 七、备注

- 当前已实现：**发送/接收摄像头数据** 和 **发送/接收视频文件**
- 核心缺失：**下位机控制帧协议** 和 **统计数据反馈显示**
- 建议下一步：与下位机团队对接，**明确控制帧和统计帧的二进制格式规范**
