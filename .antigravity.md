# 代码规范指南

## 核心原则

- 简洁优雅：代码可读性优先，避免冗余
- 类型安全：充分利用 TypeScript 类型系统
- DRY 原则：避免重复，提取共同逻辑
- 完整实现：不留待办事项、占位符或缺失部分

## Vue 3 组件规范

### 基本结构

```vue
<template>
	<!-- 模板内容 -->
</template>

<script setup lang="ts">
// Props（如需要）
const props = defineProps<{
	name: string;
	count?: number;
}>();

// Emits（如需要）
const emit = defineEmits<{
	save: [data: SomeType];
	update: [];
}>();

// 双向绑定（如需要）
const modelValue = defineModel<string>({ required: true });

// 组件逻辑
</script>
```

### 属性传递简写

```vue
<!-- 同名属性简写 -->
<Component :name :color />

<!-- 多属性传递 -->
<Component v-bind="{ name, color, size }" />
```

### 暴露给父组件

```ts
defineExpose({
	someMethod,
	someVariable,
});
```

## Electron IPC 通信规范

### 三层架构

**1. 主进程层** (`src-electron/main/ipc/`)

```ts
// xxxHandlers.ts
export function setupXxxIPC() {
	ipcMain.handle('xxx-action-name', async (_, params) => {
		return result;
	});
}
```

**2. Preload 层** (`src-electron/preload/`)

```ts
// xxx.ts
export const xxxAPI = {
	actionName: (params: ParamType) => ipcRenderer.invoke('xxx-action-name', params),
};
```

**3. 渲染进程层** (`src/core/api/`)

```ts
// xxxApi.ts
export const xxxAPI = {
	actionName: (params: ParamType) => window.electron.xxxAPI.actionName(params),
};
```

### IPC 通道命名

使用 `domain-action-name` 格式（小写短横线）：

```ts
'network-create-connection';
'network-send-data';
'window-maximize';
```

## Quasar 组件使用

- 优先使用 Quasar 组件，避免原生 HTML 元素
- 使用项目自定义的 Quasar 样式（`src/css/quasar.scss`）
- 常用组件：`q-card`, `q-input`, `q-btn`, `q-list`, `q-select`

```vue
<q-input v-model="value" label="标签" outlined class="q-mb-md" />
<q-btn color="primary" label="按钮" icon="mdi-plus" @click="handleClick" />
```

## 命名规范

- **目录**：小写短横线（`auth-wizard`）
- **组件**：PascalCase（`AuthWizard.vue`）
- **文件**：camelCase（`windowApi.ts`）
- **变量**：camelCase + 辅助动词（`isLoading`, `hasError`）
- **常量**：UPPER_SNAKE_CASE（`MAX_RETRY_COUNT`）

## 状态管理

使用 Manager 模式（非 Pinia Store）：

```ts
// theme-manager.ts
function createThemeManager() {
	const currentTheme = ref('dark');

	const setTheme = (theme: string) => {
		currentTheme.value = theme;
	};

	const initialize = async () => {
		// 初始化逻辑
	};

	return { currentTheme, setTheme, initialize };
}

export function provideThemeManager() {
	const manager = createThemeManager();
	provideLocal(THEME_MANAGER_KEY, manager);
	return manager;
}

export function useThemeManager() {
	return injectLocal(THEME_MANAGER_KEY);
}
```

在 `use-editor-managers.ts` 中注册所有 Manager：

```ts
export function createAppManagers(config) {
	const themeManager = markRaw(provideThemeManager());
	// 添加更多 manager...

	return {
		themeManager,
		initialize: async () => {
			await themeManager.initialize();
		},
	};
}
```

## 类型定义

- 共享类型放在独立的 `types.ts` 文件
- 接口使用 PascalCase 命名
- 避免在多个文件中重复定义相同类型

```ts
// types.ts
export interface ConnectionInfo {
	id: number;
	type: 'udp' | 'tcp-server' | 'tcp-client';
	localAddress?: string;
	localPort?: number;
}
```

## 文件组织

```
src/
├── core/
│   ├── api/           # API 封装
│   ├── stores/        # Manager 状态管理
│   └── types/         # 类型定义
├── pages/             # 页面组件
├── modules/           # 功能模块
├── layouts/           # 布局组件
├── components/        # 通用组件
└── css/               # 样式文件

src-electron/
├── main/
│   ├── ipc/           # IPC 处理器
│   └── network/       # 业务逻辑模块
└── preload/           # Preload 脚本
```

## 自动导入

项目使用自动导入，无需手动导入 Vue API：

```ts
// ❌ 不需要
import { ref, computed } from 'vue';

// ✅ 直接使用
const count = ref(0);
const double = computed(() => count.value * 2);
```

自动导入的内容：

- Vue API（ref, computed, watch 等）
- Vue Router（useRoute, useRouter）
- VueUse 组合式函数
- 项目组件

## 最佳实践

- **组件拆分**：单个组件不超过 300 行
- **函数拆分**：单个函数不超过 50 行
- **注释**：复杂逻辑添加注释，简单逻辑靠命名自解释
- **错误处理**：使用 try-catch，提供友好的错误提示
- **异步操作**：优先使用 async/await
