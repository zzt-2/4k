**基于SNSPD激光通信应用验证的收发处理系统**

**研制方案报告**

  ------------------ ----------------------------------------------------
  单位                                   北京理工大学

  编写               

  校对               

  审核               

  批准               
  ------------------ ----------------------------------------------------

北京理工大学

**目录**

[1、 项目概述 [1](#项目概述)](#项目概述)

> [1.1 项目来源 [1](#项目来源)](#项目来源)
>
> [1.2 引用文件 [1](#引用文件)](#引用文件)
>
> [1.3 文档概述 [1](#文档概述)](#文档概述)

[2、 技术要求 [1](#技术要求)](#技术要求)

> [2.1 功能要求 [2](#功能要求)](#功能要求)
>
> [2.2 性能要求 [2](#性能要求)](#性能要求)
>
> [2.3 接口要求 [3](#接口要求)](#接口要求)
>
> [2.4 交付形式 [3](#交付形式)](#交付形式)

[3、 总体方案设计 [3](#总体方案设计)](#总体方案设计)

> [3.1 系统组成 [3](#系统组成)](#系统组成)
>
> [3.2 结构设计 [4](#结构设计)](#结构设计)

[4、 硬件方案设计 [5](#硬件方案设计)](#硬件方案设计)

> [4.1 样机发送端 [5](#样机发送端)](#样机发送端)
>
> [4.2 样机接收端 [10](#样机接收端)](#样机接收端)

[5、 信号处理算法设计 [15](#信号处理算法设计)](#信号处理算法设计)

> [5.1 信息帧格式设计 [16](#信息帧格式设计)](#信息帧格式设计)
>
> [5.2 信号调制方式 [18](#信号调制方式)](#信号调制方式)
>
> [5.3 发送端信号处理算法
> [18](#发送端信号处理算法)](#发送端信号处理算法)
>
> [5.4 接收端信号处理算法
> [47](#接收端信号处理算法)](#接收端信号处理算法)
>
> [5.5 信道编译码算法 [56](#信道编译码算法)](#信道编译码算法)

[6、 人机交互软件设计 [85](#人机交互软件设计)](#人机交互软件设计)

[7、 技术指标分析 [92](#技术指标分析)](#技术指标分析)

> [7.1 功能指标分析 [92](#功能指标分析)](#功能指标分析)
>
> [7.2 性能指标分析 [97](#性能指标分析)](#性能指标分析)
>
> [7.3 接口指标分析 [100](#接口指标分析)](#接口指标分析)

[8、 设计指标符合表 [101](#设计指标符合表)](#设计指标符合表)

[9、 结论 [102](#结论)](#结论)

# 项目概述

## 项目来源

受南京大学委托，研制激光通信处理原理样机，用于生成电光调制所需的电信号以及对探测输出的电信号进行通信处理。

## 引用文件

-   《基于SNSPD激光通信应用验证的收发处理系统技术协议》

## 文档概述

本文档为基于SNSPD激光通信应用验证的收发处理系统项目的交付成果之一，即《基于SNSPD激光通信应用验证的收发处理系统研究方案报告》。本报告包含技术要求、总体方案设计、硬件方案设计、信号处理算法设计、人机交互软件设计、技术指标分析等。

# 技术要求

激光通信处理原理样机用于完成基于SNSPD激光通信应用验证的收发处理系统的信号处理功能。一方面，产生RZ-OOK、PPM电信号，进入电光调制模块；另一方面，接收信号读出的模拟信号或信号甄别的数字信号。如下图所示。

![图示 AI
生成的内容可能不正确。](media/image1.png){width="6.130976596675415in"
height="2.3620428696412947in"}

图1 系统组成框图

## 功能要求

1)  具备RZ-OOK、PPM通信信号产生、接收处理功能。

2)  具备组帧、信道编译码、解帧、同步、解调等功能。

3)  支持自闭环通信验证。

4)  信息传输：支持图片流、视频流、实时摄像头采集、数据等信息的发送与接收。

5)  人机交互与显示：具备操作控制、测试结果显示、存储功能。能够实时查看通信速率、通信误码率、信道编码方式可切换，具备使能探测器信号通道功能。

## 性能要求

1)  调制方式：RZ-OOK、PPM。

2)  通信速率：

<!-- -->

a)  OOK调制：RZ-OOK脉冲宽度不小于250ps；

b)  PPM调制：PPM脉冲宽度不小于200ps。

<!-- -->

3)  编译码方式：支持RS与LDPC两种编译码方式。

4)  调制信号：≥±2.5V;

5)  信息传输：视频流至少满足1080P实时传输；

6)  其他：采集通道使能，为协议控制。

## 接口要求

1)  调制信号接口为1路SMA-K，阻抗50R，单端接口。

2)  接收信号接口为1路高速10GHz采样率接口以及4路5GHz采样率接口，连接器均为SMA-K，阻抗50R单端接口。

## 交付形式

7)  激光通信处理原理样机硬件实物1套。

8)  激光通信处理原理样机测试报告1份。

9)  激光通信处理原理样机用户手册1份。

10) 激光通信处理原理样机研制方案报告1份

11) 激光通信处理原理样机软件：信号处理算法Matlab仿真以源代码形式交付并附加并要注释，激光通信处理原理样机硬件实物实物所列板卡所用模块代码代码以IP核形式交付并附加调用说明。

12) 提供下位机所有接口协议。

# 总体方案设计

## 系统组成

[图文。]{.mark}

## 结构设计

激光通信处理原理样机采用19寸标准宽度，满足上架要求，侧面大面积散热孔，内部使用风扇散热，机箱设置把手、便于携带，外观颜色统一无色差，设计如下所示。

![](media/image2.jpeg){width="2.599681758530184in"
height="1.823076334208224in"}![](media/image3.jpeg){width="3.123077427821522in"
height="1.6830063429571303in"}

（a）正面图 （b）背面图

图 4.3 激光通信处理原理样机发送端机箱设计图

![](media/image4.jpeg){width="2.5984251968503935in"
height="1.8743591426071742in"}![](media/image5.jpeg){width="3.122047244094488in"
height="1.6519116360454944in"}

（a）正面图 （b）背面图

<figure>
<img src="media/image6.png" style="width:5.17431in;height:2.79097in"
alt="G:\xwechat_files\wxid_xyq57e8utdsr22_bea5\temp\RWTemp\2025-12\7626fb1df1396bb70dc783682433c743.png" />
<figcaption><p>图 4.4
激光通信处理原理样机接收端机箱设计图</p></figcaption>
</figure>

<figure>
<img src="media/image7.png" style="width:4.93818in;height:2.79558in" />
<figcaption><p>图 4.4
激光通信处理原理样机工作状态示意图</p></figcaption>
</figure>

图 4.4 激光通信处理原理样机连接关系示意图

# 硬件方案设计

XX主要由XX组成。

## 样机发送端

样机发送端主要由高速信号产生板卡、高速信号发射板卡组成，如图4‑2所示。

### 高速信号产生板卡

高速信号产生板卡硬件组成框图如下图所示。板卡由FPGA信号处理芯片、~~10Gsps高速ADC~~、时钟管理芯片、电源芯片组、GT高速接口、高速串行接口以及网口接口组成。FPGA信号处理芯片用于模拟数据采样和信号同步、数据编译码操作，并通过高速串行接口发送至调制探测模块进行激光载波调制；高速ADC采样芯片对光收发模块输出的高速信号进行高速采样；时钟管理芯片将外部10MHz高稳时钟经过倍频、分频等操作转换为FPGA所需要的不同频率的稳定时钟；电源管理模块负责产生测试设备各模块所需的电平标准；GT高速接口以及网口用来实现信号处理模块与调制探测模块、控制交互模块的数据交互。

![](media/image9.emf)

图 41 硬件组成框图

#### FPGA信号处理芯片

本项目采用Xilinx Virtex
UltraScale+系列的XCVU9P-FLGA2104芯片，具有2586150个逻辑单元、2364480个CLB触发器、1182240个CLB
LUT，含有36.1Mb的Distributed RAM、75.9Mb的Block RAM（2160个Block
RAM块）、30个时钟管理器、832个高性能高速I/O口、6840个DSP、120个32.75Gb/s的GTY收发器。XCVU9P外挂1片16位BPI闪存。该芯片支持3D
IC的FinFET，适用于突破性密度、带宽和大规模裸片间连接，支持虚拟单片设计，DDR4存储器支持高达2,666Mb/s、高达500Mb的片上内存高速缓存，可提供更高的效率和低时延，支持ASIC仿真。FPGA芯片的分区如下图所示。

![](media/image10.png){width="5.768055555555556in"
height="4.1913232720909885in"}

图 42 XCVU9P设计分区

Virtex
UltraScale+系列的XCVU9P-FLGA2104芯片可用片上资源如下表所示，XCVU9P-FLGA2104芯片可用片上资源非常丰富，能够满足数据处理的资源要求。

表 3 XCVU9P-FLGA2104芯片可用片上资源

  ------------------------------------------------------------------------
  类别               片上资源                                参数
  ------------------ --------------------------------------- -------------
  逻辑资源           系统逻辑单元数                          2586150

                     CLB查找表                               2364480

                     CLB触发器数量                           1182240

  存储器资源         最大分配RAM（Mb）                       36.1

                     块RAM块                                 2160

                     块RAM（Mb）                             75.9

                     UltraRAM块                              960

                     UltraRAM（Mb）                          270.0

  时钟               CMT块数（1MMCM+2PLL）                   30

  I/O资源            单端口I/O最大值                         832

                     差分I/O最大值                           0

                     32.75Gb/s GTY收发器                     120

                     58.0Gb/s GTM收发器                      \-

  整合IP资源         DSP片数                                 6840

                     PCIE4（PCIe Gen3×16）                   6

                     PCIE4C（PCIe Gen3×16/Gen4×8/CCIX）      \-

                     收发器分数锁相环                        60

                     100G/50G KP4 FEC                        \-

  尺寸               47.5mm\*47.5mm                          
  ------------------------------------------------------------------------

UltraScale+架构中使用两种类型的收发器：FPGA中GTY和GTM，MPSoCs和RFSoCs中PL的GTY。所有收发器4个为一组，每个串行收发器是一个组合的发射器和接收器。

表 4 收发器信息

  ------------------------------------------------------------------------
  Virtex UltraScale+   类型    数量      最大数据速率     最小数据速率
  -------------------- ------- --------- ---------------- ----------------
                       GTY     34-128    32.75Gb/s        0.5Gb/s

                       GTM     0-48      58.0Gb/s         9.8Gb/s
  ------------------------------------------------------------------------

Virtex
UltraScale+系列芯片通过配置接口加载比特流，芯片的FPGA设计被编译为比特流，通过配置接口进行FPGA设计工作，每个芯片的完整比特流具有固定的长度。提供高性能（HP）和高密度（HD）I/O库，其中HP的I/O库旨在满足1.8V电压的高速存储器和其他芯片对于芯片接口的性能要求，HD应用于低速I/O的场景，支持3.3V的最高速率限制在250M以内的I/O标准。FPGA芯片包含高性能（HP）和高密度（HD）I/O库的不同组合，包含了Virtex
UltraScale+系列芯片的HP和HD的I/O库中支持的功能。

表 5 Virtex UltraScale+系列芯片的HP和HR I/O库支持功能对照表

  -----------------------------------------------------------------------
  功能                                        HP I/O库      HD I/O库
  ------------------------------------------- ------------- -------------
  3.3V I/O标准                                ×             √

  2.5V I/O标准                                ×             √

  1.8V I/O标准                                √             √

  1.5V I/O标准                                √             √

  1.35V I/O标准                               √             √

  1.2V I/O标准                                √             √

  LVDS信令                                    √             √

  VCCAUX_IO电源轨                             √             ×

  数控阻抗（DCI）和DCI级联                    √             ×

  内部$V_{REF}$                               √             √

  内部差分激光终端                            √             √
  -----------------------------------------------------------------------

Virtex
UltraScale+系列FPGA芯片中的可配置逻辑块（CLB）提供高性能FPGA逻辑，是用于实现时序电路和组合电路的主要逻辑资源。每个CLB元素连接于一个交换矩阵，用于访问通用路由矩阵Virtex
UltraScale+系列FPGA芯片中的输入查找表（LUT）可以配置为一个具有一个输出的6输入LUT，也可以配置为两个独立输出但是具有公共地址或公共逻辑输入的5输入LUT。八个6输入LUT及16个寄存器，以及多路复用器和算术运算逻辑器件构成一个逻辑片，一个逻辑片构成一个CLB。这些逻辑片可以将LUT用作分布式512位RAM或者256位的移位寄存器。

XCVU9P-FLGA2104芯片以及芯片中各模块的直流特性数据如下表所示：

表 6 XCVU9P-FLGA2104芯片的直流特性数据表

+------------------+-----------+---------+---------+----------+------+
| 模块             |           | 最小值  | 典型值  | 最大值   | 单位 |
+==================+===========+=========+=========+==========+======+
| 芯片内部供电     | 0.825     | 0.850   | 0.876   | V        |      |
| 电压$V_{CCINT}$  |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| 块RAM供电        | 0.825     | 0.850   | 0.876   | V        |      |
| 电压$V_{CCBRAM}$ |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| 辅助供电         | 1.746     | 1.800   | 1.854   | V        |      |
| 电压$V_{CCAUX}$  |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| I/O库供          | 1.8V HP   | 0.950   | \-      | 1.900    | V    |
| 电电压$V_{CCO}$  |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| I/O端口          | -0.200    | \-      | V       | V        |      |
| 输入电压$V_{IN}$ |           |         | CCO+0.2 |          |      |
+------------------+-----------+---------+---------+----------+------+
| 输入引脚         | \-        | \-      | 10      | mA       |      |
| 最大电流$I_{IN}$ |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| 电池             | 1.000     | \-      | 1.890   | V        |      |
| 电压$V_{CCBATT}$ |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| 不丢失数据前     | 0.698     | 0.720   | 0.742   | V        |      |
| 提下$V_{CCINT}$  |           |         |         |          |      |
|                  |           |         |         |          |      |
| 最低值           |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+
| 每个引脚的       | \-        | \-      | 15      | μA       |      |
| 输入/输出漏电流  |           |         |         |          |      |
+------------------+-----------+---------+---------+----------+------+

### 高速信号发射板卡

## 样机接收端

被测端设备主要包含：信号产生与分析处理板卡、信号调理放大模块、协议及控制板卡、19寸4U工控机箱、主控计算机、CPCIE背板、CPCI电源模块，用于按照同步转发的原理配合主测端实现通信测距功能。被测端设备硬件组成如图4‑31所示，拟采用北京理工大学通信技术研究所自主研制的工控机，与主测端主控及信号处理组合的机箱结构相同，以缩短研发周期，提高通用性和可靠性。

![](media/image11.emf)

图4‑31

被测端设备硬件组成框图

信号产生与分析处理板卡为被测端设备的核心。一方面，对上行接收信号采用滑动相关和早迟门环路实现信号捕获与跟踪，并将同步结果反馈到时频管理模块，精确恢复出上行接收时钟，并进行解调与SCPPM译码处理，包括解帧、16-PPM解调、解内码、解交织、解外码、解扰等功能。另一方面，根据恢复时钟，调整本地时钟信号与其同步，对下行信号进行模拟、调度，完成加扰、SCPPM编码、16-PPM调制、组帧、并串转换等功能，输出2路下行基带PPM调制电信号，分别至激光光源调制放大分系统模块A、B。

信号调理放大模块接收单光子探测器的PPM脉冲信号，经过带宽放大器将信号幅度放大后功分为两路，其中一路经ADC采样后转换为数字信号，在FPGA中进行信号的捕获、跟踪。另一路经过边沿提取处理，转换为PPM窄脉冲信号，发送给主测端信号合成同步模块，完成下行组阵接收试验。

协议及控制板卡用于完成被测端相关模块及其它相关分系统的状态监视、参数配置、操作控制、测距零值标定与校正功能，及其与53cm望远镜跟踪控制模块、激光光源调制放大分系统、主测端等模块的对外监测控制接口。

作为底层硬件平台，主控计算机和CPCI电源模块通过CPCIE接口为被测端各功能模块提供工作电源，并通过CPCIE接口的数据传输功能与各信号处理模块交换控制指令和测量结果。

### 高速信号采集板卡板卡

本项目上行链路采用16-PPM调制方式，时隙速率为311MHz，在此条件下，为满足奈奎斯特采样定理，本项目被测端信号产生与分析处理板卡拟采用2.5Gsps采样率的高速ADC进行采样。

信号产生与分析处理板卡主要由1片2.5Gsps高速ADC、1片Kintex7系列FPGA（内嵌高速GTX发射器）、多片时钟管理芯片、电源管理模块和1片直接数字式合成芯片组成，其中时钟管理芯片和电源管理芯片与主测端综合信号处理板卡上的配置相同，因此本节仅对2.5Gbps高速ADC芯片、高速GTX发射器、直接数字式频率合成芯片进行说明。被测端信号产生与分析处理板卡如图4‑32所示。

![](media/image12.emf)

图4‑32

被测端信号产生与分析处理板卡组成框图

本项目采用ADC12DJ5200RF芯片，其采样率最高为10.4Gsps。该芯片为射频采样、千兆采样模数转换器，具有12位分辨率，可对从直流到10GHz以上的输入频率进行直接采样。该芯片可配置为双通道5.2GSPSADC或单通道10.4GSPSADC，模拟输入带宽为8GHz。这些运行模式可通过编程方式在通道数和奈奎斯特带宽上进行权衡，从而灵活配置硬件，满足多种应用需求。可用输入频率范围高达10GHz。芯片系统组成如下图所示。

![](media/image13.gif){width="5.843389107611548in"
height="4.315667104111986in"}

图 43 ADC12DJ5200RF系统组成原理框图

ADC12DJ5200RF使用具有16个串行通道的高速JESD204C作为输出接口，支持高达17.16Gbps的线路速率。通过JESD204C子类1支持确定性延迟和多器件同步。JESD204C接口可进行配置，对线路速率和通道数进行权衡。支持8B/10B和64B/66B数据编码方案。当使用8B/10B编码模式时，向后兼容JESD204B接收器。

时钟芯片

### 高速信号接收处理板卡

### 四通道信号采集与接收处理板卡

# 信号处理算法设计

综合信息处理与测量分系统基于同步转发测距方式，上行、下行链路的调制方式、时隙速率和模数转换器（ADC）采样率分别为：

上行链路采用16-PPM调制方式，信息流向从主测端到被测端，高速模式下信息速率为38.88Mbps，时隙速率为311.04Mslot/s，低速模式下信息速率为1.22Mbps，时隙速率为9.72Mslot/s。高速模式和低速模式分别以2.5Gsps、78.125Msps采样率的ADC进行约8倍过采样。

下行链路同样采用16-PPM调制方式，信息流向从被测端到主测端，高速模式下信息速率为622.08Mbps，时隙速率为4976.64Mslot/s，低速模式下信息速率为1.22Mbps，时隙速率为9.72Mslot/s。高速模式以10Gsps采样率的高速ADC进行约2倍过采样，而低速模式以78.125Msps采样率的低速ADC进行约8倍过采样。

信号处理模块具有星座图映射、GT发送、ADC采集、同步和解调等功能，并含异常信号管理模块。组成框图如下图所示。信号处理模块将数据收发模块传来的数据进行星座图映射，然后通过GT发送基带信号，传输至调制探测模块。另一方面，信号处理模块从调制探测模块接收信号并进行ADC采集，之后进行载波同步、符号同步、盲均衡，再通过判决和帧同步，最后将数据传回至数据收发模块。此外，异常信号管理模块用于模拟激光链路通断、传输数据错误、误码，验证承载网鲁棒性。

![](media/image14.emf)

图 40 信号处理模块组成框图

## 信息帧格式设计

综合信息处理与测量分系统的数据信息由连续发送的时分复用（Time-division
multiplexed, TDM）帧组成，单个TDM帧的数据格式如图A-1所示。

TDM帧由1～16个子信道帧（Sub-channel
Frame，SCF）组成，每个子信道帧由帧同步字（Frame Alignment
Sequence，FAS）和编码数据（Code
word,CW）组成。FAS用于数据帧的同步，它由16个符号组成，CW由3780个符号组成。每个符号包含4bit信息，映射为1个16-PPM码组，它由16个时隙中单个脉冲位置表示。子信道帧（SCF）的具体格式如图A-2所示，其中原始信息码元为1890个符号，包括子信道帧计数，子信道帧数据域以及CRC校验位，其余1890个符号为采用编码率1/2的串行级联卷积码编码后产生的SCCC校验符号。各码字在附加FAS之前需要先进行交织处理，从而减小大气湍流引起的强信道衰落的影响。

在TDM帧的所有子信道帧中，帧同步字（FAS）设置为0x 41C1 D5B7 A0DE
18DF。所有的PPM时隙同步、符号同步、码字同步和TDM帧同步均以帧的FAS最后一个调制时隙的下降沿时刻作为基准。

子信道帧计数为所有子信道帧的二进制顺序计数器（模16777216，即224），其取值为0\~16777215。子信道帧计数器在达到16777215之前不复位，必须复位的情况除外。

![](media/image15.emf)

图A-1 TDM帧数据格式

![](media/image16.emf)

图A-2 子信道帧组成示意图

## 信号调制方式

### RZ-OOK调制

### PPM调制

## 发送端信号处理算法

主测端是系统运行的发起端和控制端，通过上行发射链路向被测端发送信息并将记录上行发送帧头的起始时刻，并对下行信息进行接收，并计算收发时间差，从而完成测距信息处理功能。e

主测端数字信号处理模块主要由上行信号发送模块和下行信号接收模块两大模块组成，其中下行信号接收模块包括下行信号同步模块、通信解调模块、测距信息解算模块和测角信息处理模块。主测端信号处理流程如图5‑1所示。

![](media/image17.emf)图5‑1

主测端信号处理流程

### 上行信号发送模块

主测端上行信号发送模块工作流程如下：在时频管理模块系统输出工作时钟的驱动下，对原始发送数据依次进行信道编码（SCPPM编码，包括外编码、交织、内编码）、附加帧头、格雷码映射、PPM调制等处理，输出三路电信号至激光光源调制放大模块A、激光光源调制放大模块B和激光光源调制放大模块C，同时主测端记录发送信息帧头的起始时刻和帧计数用于测距功能。上行信号发送模块的信号处理流程如图5‑2所示。上行高速与低速信号的发送原理相同，均为FPGA普通I/O端口，区别在于发送数据的系统时钟频率不同。

![](media/image18.emf)

图5‑2

上行信号发送模块信号处理流程

本项目主测端输出的上行电信号波形如图5‑3所示，其中上行信号采用16-PPM调制，时隙速率为311MHz。图5‑4中所示的是展宽后的上行电信号波形。

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\300m-xiao.bmp](media/image19.png){width="5.185184820647419in"
height="2.679990157480315in"}

图5‑3

上行电信号波形

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\300m-da.bmp](media/image20.png){width="5.166666666666667in"
height="2.6704188538932634in"}

图5‑4

展宽后的上行电信号波形

### 下行信号接收同步模块

信号同步是系统实现通信解调和测距功能的关键技术之一。同步算法包括捕获算法和跟踪算法，依赖捕获算法，快速搜索到同步码初始相位；依赖跟踪算法，使系统稳定地锁定同步码在自由空间传播时多普勒频移引起的变化。

下行链路高速模式信号为4976.64Mslot/s时隙速率的16-PPM信号，为满足奈奎斯特采样定理，本项目采用10Gsps采样率ADC芯片对主测端接收到的下行电信号进行近似2倍非整数倍采样。低速工作模式下，时隙速率为9.72Mslot/s，采样率为78.125Msps，过采样率为8倍采样。由于高速工作模式下的过采样率低、高速信号接收处理难度大，为本项目难点，因此，本节重点阐述高速工作模式下的主测端数字信号处理算法。

对于本项目帧头256位的同步码，高速工作模式近似对应514个采样点（10G/4.97664G=2.01，2.01采样点/bit×256bit=514采样点）。为便于后续信号处理，FPGA内嵌的ISERDES核将ADC采样量化输出的数字信号分别进行串/并转换，转换为多路并行低速信号，每路信号速率为156.25MHz，其数据位宽与ADC量化位宽相等。并行低速数字信号经过捕获模块与本地序列进行相关运算得到相关峰，当捕获完成后进入跟踪模块（码环），下行同步模块的信号处理流程如图5‑8所示。本项目采用基于滑动相关的捕获算法和基于早迟门的跟踪算法，下面分别详细阐述。

![](media/image21.emf)

图5‑8

下行信号同步模块信号处理流程

#### A基于滑动相关的捕获算法

捕获是信号同步的第一步，是信号的粗同步。其特点是可以在先验信息较少的情况下完成对未知参量的粗略估计。

##### （1）捕获算法原理

本项目选用滑动相关算法进行信号捕获，滑动相关算法本质上是找到相关运算的峰值点，其运算过程可以表示如下。

$Z(n) = \frac{1}{N}\sum_{m = 0}^{N - 1}{x(m)y(m - n)}$

(5-15)

其中$x$表示本地同步序列，$y$表示接收信号，$n$表示本地同步序列和接收信号的相对时延，$Z(n)$表示当前时延下本地同步序列与接收信号的相关结果。当接收信号与本地同步序列完全对齐时，$Z(n)$达到最大值，此时的$n$就是对接收信号到来时刻的估计。

捕获过程中，出现最大相关结果的位置可视为对接收信号到来时刻的估计，因此需要选择自相关性好，也就是最大相关结果远大于其它时刻的相关结果的序列作为帧同步数据。本项目中使用256bit序列"Ox
41C1 D5B7 A0DE
18DF"作为同步数据，对此同步数据做周期自相关运算，不同相对延时对应的相关结果如图5‑9所示。

![](media/image22.emf){width="5.767361111111111in"
height="4.325694444444444in"}

图5‑9

不同时延下本地同步序列与接收序列的相关结果

可以看出，由于帧同步数据具有良好的自相关特性，只有当本地同步序列与接收信号完全对齐时才会出现很大的相关值，其他位置相关值均很小。这保证了使用滑动相关方法进行捕获可以较准确地估计出接收信号到来时刻。需要注意的是PPM采样数字信号相关结果属于幅值累加，不存在负值情况，这一点与PSK相关结果有本质不同。

信号捕获的一般思路是通过捕获算法中的相关运算使信号功率高于噪声功率，从而通过门限判决找到信号出现的位置。

项目中的信噪比指标为$\frac{E_{b}}{N_{0}} = 14\text{dB}$，下式给出由$\frac{E_{b}}{N_{0}}$计算信噪比$SNR$的方法。

$SNR = \lbrack\frac{E_{b}}{N_{0}}\rbrack_{\text{dB}} + \lbrack\frac{R_{b}}{B}\rbrack_{\text{dB}} = \lbrack\frac{E_{b}}{N_{0}}\rbrack + 10*\lg(\frac{311*10^{6}}{2.5/4*10^{9}*4}) \approx 8\text{dB}$

(5-16)

项目中使用2.5GHz时钟对256时隙帧同步数据进行采样得到2048个采样点，计算方法如下所示。

$N = L*\frac{F_{s}}{R_{b}} = 256*\frac{2.5*10^{9}}{0.31104*10^{9}} \approx 2048$

(5-17)

式中，$N$表示采样点个数，$L$表示帧同步数据长度，$F_{s}$表示采样频率，$R_{b}$表示数据传输速率。在捕获过程中，1个时隙选取两个采样点即可达到粗同步，因此捕获处理选取512个采样数据进行运算。

滑动相关算法的思路是使用本地序列与接收序列作相关运算。当本地序列与接收序列完全对齐时，相关运算结果相当于将所有参与运算的采样点中的信号部分的幅值取模并累加起来。通过将这512个采样点全部累加起来，可获得$10*\lg(512/16) \approx 15\text{dB}$的增益。

下面从数学角度对其累加效果进行分析。

在AWGN信道下，如果接收到发送信号，则接收信号可以表示成$x_{1} = A + n_{1}$；如果没有接收到发送信号，则接收信号可以表示成$x_{0} = n_{0}$。其中$n_{0}\sim N(0,\sigma^{2})$，$n_{1}\sim N(0,\sigma^{2})$。

由：卡方分布$\chi^{2}(\lambda)$，均值$\mu = \lambda$，方差$\sigma^{2} = 2\lambda$；非中心卡方分布$\chi^{2}(\lambda,\gamma)$，均值$\mu = \lambda + \gamma$，方差$\sigma^{2} = 2(\lambda + 2\gamma)$，可以得知：

-   $(\frac{x_{0}}{\sigma})^{2}{\sim\chi}^{2}(1)$，均值$\mu_{0} = 1$，方差$\sigma_{0}^{2} = 2$；

-   $(\frac{x_{1}}{\sigma})^{2}{\sim\chi}^{2}(1,\gamma) = \chi^{2}(1,\frac{A^{2}}{\sigma^{2}})$，均值$\mu_{1} = 1 + \frac{A^{2}}{\sigma^{2}}$，方差$\sigma_{1}^{2} = 2(1 + 2\frac{A^{2}}{\sigma^{2}})$。

由此得到：

$\left\{ \begin{array}{r}
E(x_{0}^{2}) = \sigma^{2},Var(x_{0}^{2}) = 2\sigma^{4} \\
E(x_{1}^{2}) = A^{2} + \sigma^{2},Var(x_{1}^{2}) = 2\sigma^{4} + 4A^{2}\sigma^{2}
\end{array} \right.\ $

(5-18)

累加算法表达式如下式所示。

$\left\{ \begin{array}{r}
Y_{1} = \frac{1}{K}\sum_{k = 1}^{K}{x_{1,k},E(y_{1}) = A,Var(y_{1}) = \frac{\sigma^{2}}{K}} \\
y_{0} = \frac{1}{K}\sum_{k = 1}^{K}{x_{0,k},E(y_{0}) = 0,Var(y_{0}) = \frac{\sigma^{2}}{K}}
\end{array} \right.\ $

(5-19)

对上式的运算结果求模、取平方得到下式。

$\left\{ \begin{array}{r}
z_{1} = |y_{1}|^{2},E(z_{1}) = A^{2} + \frac{\sigma^{2}}{K},Var(z_{1}) = \frac{2\sigma^{4}}{K^{2}} + \frac{4A^{2}\sigma^{2}}{K} \\
z_{0} = |y_{0}|^{2},E(z_{0}) = \frac{\sigma^{2}}{K},Var(z_{0}) = \frac{2\sigma^{4}}{K}
\end{array} \right.\ $

(5-20)

可以得知，随累加次数$K$增加，噪声功率会降低，当累加次数足够大时，噪声可以被消除。信噪比为$SNR = \frac{KA^{2}}{\sigma^{2}}$，也就是说$K$点累加后，信噪比变为之前的$K$倍，512个采样点累加则应获得512倍的信噪比增益，鉴于本项目采用PPM调制方式，512个采样点累计实际获得32倍的信噪比增益。

当本地同步序列与接收数据中的同步序列完全对齐时，完成相关运算后，信噪比可以提高到$\left( 8\text{dB} + 15\text{dB} \right) = 23\text{dB} \approx 199$，信号功率远远高于噪声功率，可以很容易地检测到信号。${M =}\log_{2}(512) = 9$

由于信噪比很高，所以只用一组帧同步数据做捕获运算即可，无需使用多组相关结果累加的方法，节省了运算时间。

判断捕获是否成功的一般方法是将相关运算结果的峰值与门限作比较，如果大于门限，则认为捕获成功，否则认为捕获未成功，继续进行捕获。

捕获的检测概率和虚警概率是捕获性能的评价指标，检测概率指有信号发送时检测到发送信号的概率，记为$P(H_{1}|H_{1})$；虚警概率指没有信号发送时接收端（错误地）检测到信号的概率，记为$P(H_{1}|H_{0})$。

实际中既要保证较高的检测概率，又要保证较低的虚警概率。捕获的检测概率和虚警概率与门限的选取有很大关系。一般来说，降低门限可以提高检测概率，但同时也会提高虚警概率，提高门限可以降低虚警概率，但同时也会提高检测概率。所以门限的选取很重要。

恒虚警概率(CFAR)检测方法是一种基于自适应门限的检测算法，可以适应信号动态变化，它通过动态调节检测门限来保证虚警概率恒定。

恒虚警概率检测的关键是实时获取噪声功率估计值。根据Neyman-Pearson定理，信噪比门限可根据要求的虚警概率导出。如果得到了当前噪声功率估计值，只需将噪声功率乘以一个门限标度因子就可以确定具体信号门限值。

下面介绍使用Neyman-Pearson定理计算门限的方法。

首先，根据虚警概率的定义：

$P_{FA} = P(H_{1}|H_{0}) = \int_{V_{t}}^{+ \infty}{p(x|H_{0})dx}$

(5-21)

其中，$P_{FA}$是虚警概率，$x$是接收信号，$V_{t}$是信号幅度的判决门限。

在加性高斯白噪声(AWGN)信道下，信号通过窄带线性系统，其包络服从瑞利分布，由此可得：

$P_{FA} = \int_{V_{t}}^{+ \infty}{\frac{x}{\sigma^{2}}\exp( - \frac{x^{2}}{2\sigma^{2}}})dx = \exp( - \frac{V_{t}^{2}}{2\sigma^{2}})$

(5-22)

其中，$\sigma^{2}$是噪声方差，即噪声功率。

由下式可得门限$V_{t}$关于虚警概率$P_{FA}$的表达式。

$V_{t} = \sigma*\sqrt{- 2\ln(P_{FA})}$

(5-23)

式中所示为信号幅度判决门限，即如果信号幅度达到$V_{t}$则认为过门限。一般捕获中使用平方律检波器，也就是对信号噪声功率比进行门限判决，此时使用下式计算门限。

$V_{t}^{'} = \frac{V_{t}^{2}}{\sigma^{2}} = - 2\ln(P_{FA})$

(5-24)

已知虚警概率$P_{FA}$的情况下，可计算检测概率$P_{D}$。

$P_{D} = Q(Q^{- 1}(P_{FA}) - \sqrt{\frac{NA^{2}}{\sigma^{2}}})$

(5-25)

其中，$\frac{NA^{2}}{\sigma^{2}}$为N点相关运算后的信号噪声功率比，$Q(*)$定义如下所示。

$Q(a) = \int_{a}^{+ \infty}\frac{1}{\sqrt{2\pi}}\exp( - \frac{y^{2}}{2})dy$

(5-26)

实际中，使用滑动相关算法进行捕获判决时，由于相关结果是实时输出的，所以可以根据相关结果是否有拐点（当前时刻相关结果既大于上一时刻相关结果又大于下一时刻相关结果，当前时刻被称为拐点）来判断此时刻是否出现最大相关结果，即相关峰。如果出现拐点且相关结果大于门限，则认为当前时刻搜索到了相关峰，这一时刻就是捕获到的信号到来时刻。

##### （2）基于流水线的捕获算法实现方案

由于捕获算法需要在短时间内处理多路156.25MHz并行数据，占用FPGA大量硬件处理资源，为降低资源消耗，本项目采用流水线结构的滑动相关捕获算法，信号处理流程如图5‑10所示。具体实现步骤如下：

![](media/image23.emf)

图5‑10

滑动相关算法原理流程图

1)  设置一组固定长度的寄存器。本项目设为514，寄存器组中存储帧同步数据。这组寄存器在整个滑动相关算法的实现过程中不再做任何改变；

2)  设置滑动相关窗。其长度与存储帧同步数据的寄存器组长度相等，即514。滑动相关窗寄存器组初始值为全"0"；

3)  滑动相乘累加。每过一个时钟周期，输入数据传递给滑动相关寄存器组的最低位，寄存器数据向高位顺序移位一次，最高位数据溢出舍弃。寄存器数据与存储帧同步数据的寄存器组中相同位置的数据对应相乘累加得到相关值；

4)  相关峰。当寄存器数据与存储帧同步数据的寄存器组数据完全相等时，即本地序列与接收数据完全对齐的时刻，出现相关峰。下一时钟接收到的数据为帧头后的第1比特有效数据。

##### （3）捕获算法详细方案设计

1)  本地帧头寄存器固定存储用于同步的256bit帧头数据，总共514个采样点（2.01采样点/bit×256bit=514采样点）。滑动寄存器组存储接收数据，也是514个采样点。

2)  如图5‑11所示，一组寄存器固定存储用于同步的256bit帧头数据，总共512个采样点。另一组寄存器存储接收信号，也是总共512个采样点，每个采样点位宽为M（M即为A/D输出信号位宽），初状态可设置为全'0'。

![](media/image24.emf)

图5‑11

滑动相关算法实现结构

图5‑12给出滑动相关算法的实际工作流程。第1个时钟周期，第1个采样数据进入滑动相关寄存器组的最低位，其余各位依次向其高位顺序移动一位。将滑动相关寄存器组中的数据与存储帧同步数据的寄存器组中相同位置的数据对应相乘，然后将所有相乘结果累加。

![](media/image25.emf)

图5‑12

第1个时钟周期

如图5‑13所示，第2个时钟周期，第2个采样数据进入滑动相关寄存器组的最低位，其余各位依次向其高位顺序移动一位，之前进入的第1比特数据此时移动到寄存器组的次低位。将滑动相关寄存器组中的数据与存储帧同步数据的寄存器组中相同位置的数据对应相乘，然后将所有相乘结果累加。

![](media/image26.emf)

图5‑13

第2个时钟周期

如图5‑14所示，第512个时钟周期，第512个采样数据进入滑动相关寄存器组的最低位，其余各位依次向其高位顺序移动一位。此时相关运算得到最大值，出现最大相关值的时刻是本地序列与接收数据完全对齐的时刻。

![](media/image27.emf)

图5‑14

第64个时钟周期

由图5‑15可以看出，滑动相关器需要在一个时钟周期内完成512点相关运算，即在一个时钟周期内做512次乘法（实际中运算并不需要做乘法，下文还会提到这一点）以及511次加法，实际中这种做法会对处理时钟造成较大压力，影响系统速率。所以一般采用流水线结构实现滑动相关算法。

使用流水线结构需要M级运算（${M =}\log_{2}(512) = 9$）完成相关结果的计算，输出结果比输入数据延迟M个时钟周期。由于每组数据完成一级运算后立即输入到下一级运算，所以各组数据之间没有影响。使用流水线结构可以实时地完成运算，中间没有间断或停滞。

![](media/image28.emf)图5‑15

滑动相关算法流水线结构

##### （4）捕获频偏估计

当系统相对频偏较高时，可能出现误捕或失锁的情况，对于同步转发测距方式而言，捕获失误即意味着测距失败，因此需要解决系统频移过大导致系统误捕的情况。为了降低捕获出错概率，保证系统可靠性，本项目采用捕获频偏估计方法，采用连续M帧帧头捕获方法，如图5‑16所示。

![](media/image29.emf)

图5‑16

捕获频偏估计状态转换图

假设理想接收信号时隙速率为$R_{b}$，采样速率为$F_{s}$，帧头长度为$L$，时间精确测量码表向量为$depth$，则本地估计的一帧捕获采样点数$P_{h}$为：

$P_{h} = L \times \frac{F_{s}}{R_{b}} \times 2^{depth}$

(5-27)

在连续$M$帧时间长度$\Delta t$内累计的本地估计采样点数为

$P_{H} = M \times P_{h}$

(5-28)

实际采样过程中，由于非整数倍采样和传输频偏的存在，实际相位增量相比本地估计值有相对偏差。假设在时间$\Delta t$内实际累计采样点数为$P_{R}$，则在$\Delta t$内实际采样点数与连续$M$帧估计采样点数和的比值$N$为

$N = \frac{P_{H}}{P_{R}} = \frac{M \times P_{h}}{P_{R}}$

(5-29)

比值$N$起到衡量在一定时间内实际相位增量较理想的相位增量的变化程度，从而反映出实际频差。实际送入跟踪模块的初始相位增量为

$Phase\_ ini\_ real = (R_{b}/F_{s}) \times 2^{depth} \times N$

(5-30)

由于非整数倍采样和传输频偏的存在，实际相位增量相比本地估计值有相对偏差。通过比对一定时间内理想采样点数和实际采样点数的变化，可以衡量在一定时间内实际相位增量较理想的相位增量的变化程度，从而反映出实际频差。随着连续帧数$M$的增加，捕获频偏估计精度逐渐提高，但在实际应用过程中，粗同步有一定的时间限制，并且受频率源的误差及噪声影响，捕获精度不可能随帧数的增加而无限制提高。

#### B基于早迟门的跟踪算法

主测端下行信号接收模块在完成对信号的捕获之后转入同步模块。同步模块主要包括积分清除、鉴相、环路滤波器和码NCO，如图5‑17所示。接收同步码通过归一化超前减滞后功率鉴相器比较实际采样的同步码和本地产生的同步码之间的相位差（时间差），再根据经过二阶环路滤波后得到的相位差，对下一次同步码的产生进行调整，使之尽可能与实际采样得到的同步码保持一致，最终实现本地产生的同步码与采样得到的信号中的同步码完全一致（即同频同相）的同步功能。通过产生本地的同步码，接收机可以精确测量出接收信号的延时，进而得到精确地伪距测量。

![](media/image30.emf)

图5‑17

跟踪算法原理图

##### （1）积分清除

积分清除将同一时刻的实际采样点与本地同步码对应相乘累加，用于计算本地信号产生的同步码与实际接收的同步码之间的差异。图5‑18和图5‑19分别为同步码与原始同步码对齐和未对齐时对应相乘的结果。

![](media/image31.emf)

图5‑18

同步码对齐时的相乘结果

![](media/image32.emf)

图5‑19

同步码未对齐时的相乘结果

对图5‑18和图5‑19可知，当本地信号与实际采样信号完全一致（即对齐）时，累加的结果一定是一个不断增大的值，则最终的积分清除结果很大。而当本地信号与实际采样信号不一致（没有对齐）时，累加的结果则是一个比较小的值。

接收机本地码发生器通过循环移位产生三路本地同步码，分别称为超前、即时和滞后支路。三路本地同步码（超前、即时、滞后）与接收同步码的积分清除的过程如图5‑20至图5‑22所示。首先，接收机计算出同步码中第一个采样点的位置。其次，当第一个采样点到来时，连续将514个采样点与本地产生的3路同步码进行相关运算，得到三个积分清除结果。最后，将超前支路和滞后支路的相关结果输入到鉴相模块。

![](media/image33.emf)图5‑20

超前支路积分清除示意图

![](media/image34.emf)图5‑21

即时支路积分清除示意图

![](media/image35.emf)图5‑22

滞后支路积分清除示意图

在理想状态下即时支路的积分清除结果最大，超前支路的积分清除结果和滞后支路的积分清除结果较小，如图5‑23所示。图5‑23(a)表示本地同步码与接收同步码对齐时的积分清除结果，此时即时支路（P路）较大，超前支路（E路）和滞后支路（L路）较小且相等；图5‑23(b)超前支路（E路）小于滞后支路（L路），表示即时支路的本地同步码超前于接收同步码的情况；图5‑23(c)超前支路（E路）大于滞后支路（L路），表示即时支路的本地同步码落后于接收同步码的情况。

![](media/image36.emf)图5‑23

积分清除结果

##### （2）鉴相器

对于积分清除模块输出的超前和滞后的积分清除结果$I_{E}$和$I_{L}$，鉴相模块使用归一化超前减滞后功率鉴相器算法来计算$I_{E}$和$I_{L}$之间的差异。其计算公式为

$E_{C_{k}} = \frac{I_{E}^{2} - I_{L}^{2}}{I_{E}^{2} + I_{L}^{2}}$

(5-31)

当跟踪算法已经运行稳定时，$I_{E}$和$I_{L}$之间的差值应当是一个极小的值，表明接收到的同步码与本地产生的即时支路同步码是完全一致的，超前支路和滞后支路分别处于即时支路对称的两侧，两者的积分清除结果几乎一样。此时鉴相结果应当是0。

当跟踪算法没有稳定，$I_{E}$和$I_{L}$之间的差值应当是一个较大的值，表明接收到的同步码与本地产生的即时支路同步码是不一致的。此时，可能是超前支路与接收到的同步码是一致的，也可能是滞后支路与接收到的同步码是一致的。这时，两者之间的差异很大，鉴相结果是一个很大的值（较大的正值或较小的负值）。

鉴相的结果被进行归一化处理后，输入到环路滤波模块。

##### （3）环路滤波器

环路滤波模块主要是对输入的鉴相结果进行滤波，以消除环路中的噪声干扰和同步中的部分动态并控制码NCO调整的速度和程度。本项目环路算法采用二阶伪码跟踪环，其滤波器为一阶理想积分低通滤波器。环路滤波器的数字实现形式如图5‑24所示。

![](media/image37.emf)

图5‑24

环路滤波器数字实现

环路滤波算法采用二阶Jaffe-Rechtin滤波器算法，其算法如下所示。

${\overline{\tau}}_{k + 1} = {\overline{\tau}}_{k} + (\omega_{nF}^{2}T) \cdot (ec_{k} \cdot K_{d}/K)$

(5-32)

${\overset{\land}{\tau}}_{k + 1} = {\overset{\land}{\tau}}_{k} + T{\overline{\tau}}_{k + 1} + (\sqrt{2}\omega_{nF}T) \cdot (ec_{k} \cdot K_{d}/K)$

(5-33)

式(5-32)中，${\overline{\tau}}_{k}$为第k次同步码的相位估计，$T$为环路滤波器的输入更新时间，$\omega_{nF}$为环路滤波器的自然角频率（$\omega_{nF} = 1.89B_{L}$,$B_{L}$是环路带宽）。

环路滤波器最终产生输出给码NCO的控制字$\Delta P_{k + 1}$的计算如下所示。

$\Delta P_{k + 1} = \frac{{\overset{\land}{\tau}}_{k + 1} - {\overset{\land}{\tau}}_{k}}{2\pi T} \cdot K_{f} = \frac{{\overline{\tau}}_{k + 1} + (\sqrt{2}\omega_{nF}T) \cdot ec_{k}}{2\pi} \cdot K_{f}$

(5-34)

式(5-34)中，$\Delta P_{k + 1}$为滤波器输出的输出频率字增量，在频率字更新时，该频率字增量与码环频率字偏置$P_{Bias}$相加后得到码速率控制字(FTW)，$K_{f}$为频率字转换系数。

环路滤波器的核心参数是环路带宽![](media/image38.wmf)。当环路滤波的带宽设计较大时，可以提高调整的速度，即当相位有微小的变化时，可以得到快速、大幅度的调整。这样虽然能够使环路更快入锁，但是环路的稳定性不好，微小的动态可能引起环路的波动。当环路滤波的带宽设计较小时，可以提高调整的精确性，即当相位有偶然的、突发的变化时，调整的程度不至于过大过快，这样使得整个环路更加稳定，但是每次调整的力度小，环路入锁的速度较慢。因此，环路带宽的选择需要综合考虑稳定性与调整速度两方面因素。

本项目采用一套完整的带宽调整策略：

(a).初始带宽设置：当接收机第一次进入同步算法时，采用一个较大的环路带宽$B_{ini}$；

(b).入锁判断：当接收机运行同步算法N次之后，并且在这N次之内一直处于锁定状态，判定入锁，并开机进行环路带宽调整；

(c).进行环路带宽调整：接收机运行K次环路后，带宽$B_{ini}$减小$k \times \Delta B$，当环路带宽降低为$B_{stable}$时，停止调整环路带宽，进入稳定运行阶段。

环路滤波最终产生本地同步码的码速率控制字(FTW)，并将FTW输入到本地同步码NCO产生模块。

##### （4）码NCO

码NCO根据环路滤波器输出的码控制字FTW产生新的本地同步码，用于下一次循环中积分清除模块的三路本地同步码（超前、即时、滞后）。本地同步码的产生基于数控振荡器原理。数控振荡器的工作过程可以简单地描述成累加以及溢出返零后再累加。如图5‑25所示。FTW作为控制输入，数控振荡器中的累加器在每一次系统时钟到来时增加FTW；当累加器的计数值达到最大后则溢出返零，数控振荡器就产生了一个周期的同步码。

![](media/image39.emf)

图5‑25

码NCO工作原理示意图

本项目同步码长为256位，因此，采用8位地址的ROM存放同步码。为了保证码速率的精度，采用32位低位表示小数位。码相位用32+8=40bit的累加器$phase\_ code$表示。同时，FTW也存储在一个40bit的寄存器里。每个时钟来临时，累加器都要执行计算如下

$Phase\_ code = Phase\_ code + FTW$

(5-35)

其中$Phase\_ code$的高8位作为ROM的地址，通过查询ROM表来产生本地同步码。

##### （5）参数选择

伪码跟踪精度决定着伪距测量精度，影响伪码跟踪精度的主要因素为热噪声和外界输入信号的动态应力。超前减滞后功率的DLL环路的热噪声误差（$1\sigma$）表达式如下所示。

$\sigma_{tDLL} = \sqrt{\frac{B_{L}d}{2C/N_{0}}(1 + \frac{1}{TC/N})}$（chip）

(5-36)

式中，$\sigma_{tDLL}$为热噪声引起的跟踪误差的标准差，$B_{L}$为伪码跟踪环路带宽，$T$是积分清除时间，*d*是超前和滞后相关间隔，*C/N*为载噪比。码跟踪环的稳态误差大小是和目标的径向速度、加速度和加加速度的大小相关的。

二阶码环的$3\sigma$稳态误差如下所示。

$T_{eDLL} = \frac{d^{2}\tau/dt^{2}}{\omega_{n}^{2}} = \frac{0.2818\tau^{2}}{B_{L}^{2}}$

(5-37)

式中，$\tau^{(2)} = d^{2}\tau/dt^{2}$表示到目标的径向速度、加速度和加加速度导致的码多普勒二阶导数和$2\pi$的乘积。经验方法的跟踪门限为热噪声和动态应力造成的$3\sigma$跟踪误差不允许超过相关间距的一半，如式下所示。

$3\sigma_{DLL} = 3\sigma_{nDLL} + T_{eDLL} \leq \frac{d}{2}$

(5-38)

最优环路带宽的确定是根据最小跟踪误差原则。跟踪环路的最优带宽与输入信号载噪比直接相关，同时与信号的动态直接相关。但是环路带宽只是特定条件下的最优，当外界条件变化时，环路带宽将不再是最优的了。对二阶超前减滞后功率鉴相器的伪码跟踪环路的最优带宽如下所示。

$(B_{L})_{DLL\_ optimum} = 0.6755\sqrt{\frac{\tau^{2}}{\frac{d}{2C/N_{0}}(1 + \frac{2}{(T(2 - d)C/N_{0})})}}$

(5-39)

### 通信解调模块

通信解调依赖于同步模块解算获得的频率字$Phase\_ code$和上一帧数据的相位残余量。二者是基于对数据帧中长度为16符号的帧头数据处理获得的估计值，尽管通过这两个参量可实现环路的稳定跟踪，但由于诸如信道噪声、量化噪声以及数字信号和模拟信号之间差异等因素的影响，相位量化误差不可避免。这使得通过这两个参量重采样获得的本地PPM符号与实际接收的采样数据不完全一致，当估计的符号长度发生变化时，时隙之间易产生1个采样点的偏移，在2倍过采样率的条件下极大地恶化了误码性能。

本项目下行链路的解调采用基于重采样的单点抽样判决算法。对于任意单一时隙的判决可认为是满足判决条件的二进制信号抽样判决，其判决结果为：

$\widehat{r}(t) = \max\left\lbrack \int_{0}^{T_{S}}{r(t)s_{i}(t)dt} \right\rbrack,i = 0,1$

(5-40)

其中，$r(t)$为叠加了噪声和动态信息的接收下行信号，$s_{i}(t)$为本地信号。二进制的相关接收机结构示意图如图5‑26所示。

![](media/image40.emf)

图5‑26

二进制信号的相关接收判决示意图

由于本地重采样的PPM符号中脉冲所在位置电平表示为$s_{1}(t) = 1$，其他位置电平表示为$s_{0}(t) = 0$，因此图5‑26所示的接收机可以简化为仅包含$s_{1}(t)$支路的接收机，即图5‑27。

![](media/image41.emf)

图5‑27

下行相关接收判决结构示意图

基于重采样的单点抽样判决中，抽样时刻的计算是难点。只有避免因环路参数估算误差而导致重采样点产生偏差的干扰，才能获得好的误码性能。由自相关函数的对称性可知，乘法器输出信号$r(t)s_{1}(t)$的最佳抽样时刻在$t = T_{b}$处。由于本地重采样的时隙为二进制信号，因此乘法器的运算结果为保留所有时隙，乘法器输出后的最佳抽样时刻，对应乘法器输出之前$t = T_{b}/2$的时刻。因此抽样时刻计算模块的任务为找到ADC采样数据中采样位置处于时隙中心的点。

由于下行信号为2.01倍过采样，因此下行链路任意一个时隙中的采样点数为2点或3点。若当前时隙采到3个点，分别用$s_{1}(n_{0})$，$s_{1}(n_{1})$，$s_{1}(n_{2})$表示，则三个采样点的相位关系必然满足：

$$\left| \frac{phase\_ pt\left( n_{1} \right)}{2^{32}} - 0.5 \right| > \left| \frac{phase\_ pt\left( n_{0} \right)}{2^{32}} - 0.5 \right|$$

$\left| \frac{phase\_ pt(n_{1})}{2^{32}} - 0.5 \right| > \left| \frac{phase\_ pt(n_{2})}{2^{32}} - 0.5 \right|$

(5-41)

此时$s_{1}(n_{1})$为抽样判决时刻对应的采样点。若当前时隙内采到2个点，设分别用$s_{1}(n_{0})$，$s_{1}(n_{1})$表示，且$phase\_ pt(n_{0}) < phase\_ pt(n_{1})$。则两个采样点必定位于时隙中心时刻$t = T_{b}/2$的两侧，因此最佳抽样时刻对应的采样点由下式给出。

$\widehat{r}(t) = \left\{ \begin{matrix}
s_{1}(n_{0})，\frac{phase\_ pt(n_{0}) + phase\_ pt(n_{1})}{2^{32}} \leq 1 \\
s_{1}(n_{1})，\frac{phase\_ pt(n_{0}) + phase\_ pt(n_{1})}{2^{32}} > 1
\end{matrix} \right.\ $

(5-42)

基于重采样的单点抽样判决算法原理图如图5‑28所示。假设当前到来的ADC采样数据点经算法计算已处于时隙"2"中，因此第一步是根据估算的相位对本地$s_{1}(t)$信号进行重采样，再将本地采样数据与ADC采样数据对相乘。完成相关后，由于当前时隙估计的采样点数为3点，因此选择第二个采样点作为抽样时刻对应的采样点，并进行后续的门限判决。

![](media/image42.emf)

图5‑28

基于重采样的任意时隙单点抽样判决原理（以时隙2为例）

基于重采样的单点抽样判决流程图如图5‑29所示。每帧数据到来之前，同步模块会计算出对即将到来帧的频率字估计值$Phase\_ code$和上一帧数据的相位残余量，同时根据即将到来帧的同步结果计算下一帧的采样点数和即将到来帧的相位残余量，并按照下述4个步骤进行解调判决：

①从数据帧帧头到达时刻开始，计算任意采样点所属时隙位置；

②按照估算所得的每个时隙应有采样点数，对本地$s_{1}(t)$重采样，同时划分接收的采样数据；

③通过对比接收的采样点数和估算所得本帧采样点数判定当前采样数据是否属于本帧数据。若是，继续按步骤④进行本帧内的解调；若否，回到步骤①开始下一帧的解调；

④选择最佳抽样时刻并判决；回到步骤②接收下一个时隙的数据，直至接收完本帧的全部数据。

![](media/image43.emf)

图5‑29

基于重采样的单点抽样判决流程图

## 接收端信号处理算法

被测端是系统完成通信测距功能的关键部分，负责接收主测端发送的上行数据，基于同步转发测距方式，从上行数据中恢复出时钟，并以此时钟为基准向主测端发送下行数据。被测端数字信号处理算法与主测端数字信号处理算法的主要不同之处在于：

（1）发送端口不同。由于下行发送信号在高速模式下的时隙速率为4976.64Mslot/s，而FPGA普通I/O端口无法满足高速发送需求，因此，高速模式下的被测端发送模块必须采用GTX端口进行下行高速发送。低速模式仍为FPGA普通I/O端口。

（2）接收采样倍数不同。与主测端采样倍数（高速2倍、低速8倍）不同的是，被测端分别采用2.5Gsps和78.125Msps采样率的ADC对接收上行信号进行8.04倍非整数倍采样。由于被测端高低速采样倍数相同，因此采用相同的同步算法。

（3）时钟处理方式不同。本项目采用同步转发测距方式，因此被测端下行信号发送模块中的GTX需根据上行信号接收同步模块精确恢复的本地时钟调整外部DDS专用芯片的频率控制字，进而保证下行发射链路与上行接收链路保持严格锁定。

（4）测距和测角信息解算。主测端为链路的控制端和发起端，被测端无需进行测距信息解算和测角信息处理。

被测端数字信号处理模块包括：上行信号接收同步模块、通信解调模块和下行信号发送模块。被测端信号处理流程如图5‑36所示。

![](media/image44.emf)

图5‑36

被测端信号处理流程

### 上行信号接收同步模块

被测端接收机工作在高速模式下时，接收高速信号的时隙速率为311.04Mslot/s，采样率为2.5Gsps；工作在低速模式下时，接收的低速时隙速率为9.72Mslot/s，采样率为78.125Msps，高速和低速模式下信号采样倍数均为8.04倍过采样，因此信号同步算法原理相同。

对于本项目帧头256位的同步码，接收采样信息近似对应2057个采样点（8.04采样点/bit×256bit=2057.61采样点，下取整），采样点间隔为0.125个时隙，因此上行接收捕获滑动寄存器组存储接收数据为2057个采样点。上行捕获滑动相关器需要在一个时钟周期内完成2057个点相关运算，即在一个时钟周期内做2057次乘法以及2057次加法，需要完成11次相关结果的计算。

在信号跟踪方面，积分清除相关运算本地存储的同步码长度增加为2057个，当地一个采样点到来时，连续将2057个采样点与本地产生的同步码进行相关运算。同时为避免频偏过大易导致上、下行环路失锁，跟踪方案进行以下优化：

（1）减小相关阈值。避免噪声和信道衰落造成反复失锁；

（2）缩小运算范围。捕获阶段已经检测到帧头的到达时刻，根据帧结构和收发时钟可知后续帧头的大致到达时刻，为了减少系统运算量，跟踪阶段仅在帧头到达时刻的小范围内进行相关运算，考虑到帧头到达时刻偏离值在一个时隙以内仅需提前1\~2个时隙开启相关运算即可；

（3）关闭部分处理支路。通过系统动态分析可知，相比于静态情况，多普勒造成的符号接收时间偏移量最大为0.8个时隙，因此，可关闭部分相关支路，仅保留及时支路及其左右各1个支路。

同步转发测距方式下的被测端上行信号接收同步模块需要对转发时钟进行精确恢复，跟踪模块中的码NCO输出频率控制字到外部专用DDS芯片，从而合成下行链路转发时钟。本项目被测端内部自闭环的结构如图5‑37所示。

GTX发送的高速串行信号由16路低速并行信号组成，单路信号发送时钟频率为$4976.64 \times 10^{6}/16 = 311.04 \times 10^{6} = 311.04\text{Mslot/s}$，因此由DDS合成的时钟频率为$311.04\text{Mslot/s}$。在正常发送高速串行信号的同时，将并行多路低速信号中的一路复制到自闭环同步模块，由ADC分频得到的采样时钟对该路低速信号进行采样，并对采样信息进行信号的捕获、跟踪操作，具体同步流程与信号同步模块相同。通过自闭环的信号同步流程，最终可以得到一个不含传输链路多普勒频移，而只含有DDS频偏和相偏的频率控制字（$\text{FT}\text{W}_{\text{self}}$），将$\text{FT}\text{W}_{\text{self}}$与信号同步环路解算出的$\text{FTW}$进行合成后再送入DDS进行时钟合成，消除DDS自身的频偏相偏影响。

![](media/image45.emf)图5‑37

被测端内部自闭环结构

由于内部自闭环的信号产生、采样、信号同步过程均在FPGA内部完成，只有信号发送时钟经过了DDS合成，因此自闭环系统不经过外部信号传输链路，节省了接口资源，能够实现被测端测距转发系统同步的精确校准。

被测端在转发低速下行信号时，同样需要使用DDS芯片合成下行转发时钟，但在发送部分不需要经过GTX高速发送接口，而是对合成的时钟频率进行分频，得到适用于下行低速信号传输模式的时隙速率，通过低速发送接口输出下行低速串行PPM信号。

### 通信解调模块

上行链路采用16-PPM调制方式，接收数据在接收机中近似于8倍过采样，因此相位估计误差造成的一个采样点偏移可通过积分的方式进行抑制。故按照最大似然准则进行相关接收，此时判决得到的误码率理论上达到最小值，判决准则为

$\widehat{r}(t) = {argmax}\left\lbrack \int_{0}^{T_{S}}{r(t)s_{i}(t)dt} \right\rbrack,i = 0,1,...,15$

(5-53)

其中，$r(t)$是叠加了噪声和动态信息的上行接收信号，![](media/image46.wmf)表示根据最大似然准则估计的所接收到的符号，argmax函数表示在所有![](media/image47.wmf)取所有值的条件下找到值最大的结果。由判决准则式可得到等先验概率的16-PPM符号的最佳接收原理如图5‑38。

![](media/image48.emf)

图5‑38

上行链路16-PPM相关接收法原理图

经接收机同步的上行链路信号，其包含的发射机动态和时间信息已在本地获得，并转换成了每帧的相位残余和频率步进$Phase\_ code$。相位残余代表对当前接收数据帧初相的估计，频率步进代表对当前接收数据帧任意两个采样点之间相位差的估计。由于每帧长度为固定的60736个时隙，每个时隙进行32bit深度的量化，因此通过相位残余和频率步进可以估算当前接收数据帧的长度（采样点数），以及每一个采样点的所属符号和符号内的所在时隙。

图5‑39为上行链路16-PPM基于重采样的相关接收原理图。由于每个16-PPM符号有16个时隙，因此每个符号可能的采样点数为128点或129点。按照估算所得当前接收数据帧采样点所属PPM符号中的时隙标号对本地存取的16个PPM符号进行重采样，将重采样的本地信号与当前接收数据帧中的采样点对应相乘，并在一个符号周期内积分，最后在![](media/image49.wmf)时刻进行判决即可得到按照最大似然准则获得的最佳误码性能。尽管本地对16个PPM符号采样重采样得到的数据点数在任意两个符号周期之间有所不同，但在任意符号周期内重采样的数据点数是相同的。按照最长采样点数进行积分，当长度不足时自动补零，即可解决非整数倍采样造成符号重采样点数变化的问题。

![](media/image50.emf)

图5‑39

上行链路16-PPM基于重采样的相关接收法原理图

上行链路16-PPM基于重采样的相关接收流程图如图5‑40所示。每帧数据到来之前，同步模块会计算出对即将到来帧的频率字估计值$Phase\_ code$和上一帧数据的相位残余量，同时根据即将到来帧的同步结果计算下一帧的采样点数和即将到来帧的相位残余量。并按照下述4个步骤进行解调判决：

1.  从数据帧帧头到达时刻开始，计算任意采样点所属时隙位置；

2.  按照估算所得的每个时隙应有采样点数，对本地![](media/image51.wmf)至![](media/image52.wmf)共16条支路进行重采样，按照1个PPM符号包含16个时隙的关系重新划分各支路的本地采样点和接收的采样数据；

3.  通过对比接收的采样点数和估算的本帧采样点数判定当前采样数据是否属于本帧数据。若是，继续按步骤④进行本帧内的解调；若否，回到步骤1开始下一帧的解调；

4.  将本地重采样数据和接收到的采样数据逐点对应相乘并积分，最后在![](media/image53.wmf)时刻按照抽样判决式进行判决；回到步骤②接收下一个符号的数据，直至接收完本帧的全部数据。

![](media/image54.emf)

图5‑40

上行链路16-PPM基于重采样的相关接收流程图

### 下行信号发送模块

当系统工作在测距模式时，下行发射链路需要和上行接收链路保持严格锁定，在完成通信任务的基础上实现同步转发测距；当系统工作在非测距模式时，下行高速发射链路以固定速率（5Gslot/s）向主测端发送高速数据，实现通信。另外，组帧后的16路低速并行数据（311Mslot/s）需要并串转换为一路5Gslot/s的高速串行数据。下行高速信号发送模块信号流程如图5‑41所示。由于下行高速PPM信号的发送速率高，FPGA的普通IO端口无法满足4.97Gslot/s时隙速率要求，本项目采用GTX高速接口进行发送，其参考时钟来自FPGA外部的DDS专用芯片，该DDS芯片的频率控制字信息为自闭环算法的码NCO。

![](media/image55.emf)图5‑41

下行信号发送模块信号流程

下行低速信号发送模块在发送接口部分与下行高速信号发送模式不同，下行低速信号发送模块是使用FPGA普通IO端通过16-PPM调制的单路低速串行数据（9.72Mslot/s）直接发送，不经过高速GTX接口，使用的信号发送时钟则是由DDS芯片输出的GTX参考时钟32倍分频获得。下行高低速信号发送工作可同步进行，互相独立且互不影响。

被测端输出的下行高速电信号波形如图5‑42所示，其中下行的高速串行数据为16路低速并行数据进行并串转换后，由GTX高速接口发送。图5‑43中所示的是展宽后的下行高速电信号。

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\5g-xiao.bmp](media/image56.png){width="5.768055555555556in"
height="2.98125in"}

图5‑42

下行高速电信号波形

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\5g-da.bmp](media/image57.png){width="5.768055555555556in"
height="2.98125in"}

图5‑43

展宽的下行高速电信号波形

## 信道编译码算法

信道编译码模块由编码器和译码器两部分组成。组成框图如下所示。其中编码器部分由控制单元控制，可选择RS和LDPC两种编码方式，接收并处理来自数据收发模块的数据并发回。类似，译码器部分也由控制单元控制，可选择RS和LDPC两种译码方式，接收并处理来自数据收发模块的数据并返回。

![](media/image58.emf)

*图 62 信道编译码模块*

### RS编译码方案

RS码具有良好的随机纠错和突发纠错能力，而且编译码算法复杂度低，被国际电信联盟(ITU)推荐为光纤子系统的前向纠错(FEC)码。RS(255,223)码被CCSDS选为常规分包遥测信道纠错编码和高级在轨系统前向和反向链路的纠错编码，是实现CCSDS标准低差错率信道纠错编码的关键算法。

#### 码型设计

RS编码的数据域为848字节，结构如下所示。

![](media/image59.emf)

图 63 数据域结构

本项目采用CCSDS建议的RS(255,223)编码，每个符号的比特数$m = 8$，每个码字的符号数$n = 255$，每个码字的纠错能力$t = 16$，它是由编码前223个符号和编码后生成的32个校验符号构成的，其组成如下图所示。

![](media/image60.emf)

图 64 RS(255,223)组成

RS(255,223)码的域生成多项式为

$$F(x) = x^{8} + x^{7} + x^{2} + x + 1$$

码生成多项式为

$$g(x) = \prod_{j = b}^{b + 2t - 1}{(x - \alpha^{11j})} = \sum_{i = 0}^{2t}{g_{i}x^{i}}$$

其中，$F(\alpha) = 0$，$\alpha^{11}$为$GF(2^{8})$域上的本原元素。当$b = 2^{m - 1} - t$时，生成多项式的系数具有对称性，即$g_{i} = g_{2t - i}$，且$g_{0} = g_{2t} = 1$。CCSDS建议对于RS(255,223)编码选取$b = 112$，使得生成多项式的系数具有对称性，减少乘法器数量。

#### RS编码器方案设计

RS（255,223）编码与交织相结合的编码器结构如下图所示。

![](media/image61.emf)

图 65 编码器结构

将待编码的信息数据流输入编码器，开关$S_{1}$和$S_{2}$保持同步切换，在1到4（4为交织深度）个编码器间按照1，2，3，4的顺序每次停留1个符号（长度为1字节）的时间。每个编码器处理223个符号数据，输入的信息总长度为223\*4=892字节。编码完成后输出的RS校验数据总长度为32\*4=128字节。

输入的信息数据流序列为$d_{1}^{1}\ldots d_{1}^{4}d_{2}^{1}\ldots d_{2}^{4}\ldots d_{223}^{1}\ldots d_{223}^{4}$，其中$d_{j}^{i}$为一个输入信息符号（长度为1字节），$d_{1}^{i}d_{2}^{i}\ldots d_{223}^{i}$为输入第i个编码器的信息数据流。

输出的校验数据流序列为$p_{1}^{1}\ldots p_{1}^{4}p_{2}^{1}\ldots p_{2}^{4}\ldots p_{32}^{1}\ldots p_{32}^{4}$，其中$p_{j}^{i}$为一个输出校验符号（长度为1字节），$p_{1}^{i}p_{2}^{i}\ldots p_{32}^{i}$为第i个编码器输出的校验数据流。

每个RS编码器采用反馈移位寄存器对输入的信息比特做处理，其中g0\~g15表示生成多项式系数，生成多项式为$x^{8} + x^{7} + x^{2} + x + 1$。当编码器输出信息数据时，将开关K1切换到下端，开关K2闭合；输出校验数据时，将开关K1切换到上端，开关K2打开。此外，寄存器的初始值全部设置为1。

![](media/image62.emf)

图 66 RS(255,223)编码器实现框图

实现编码时，先按照交织编码器的编码规则在每个编码器输入6字节的虚拟填充数据（填充内容为全0序列），再将总长度为868字节的编码前RS码信息位输入交织编码器中。实际上每个编码器接收到6字节虚拟填充数据和217字节待编码数据，构成223字节（即223个符号）的待编码数据块，如下所示。

![](media/image63.emf)

图 67 实际编码数据流示意图

经过上述交织编码过程后，输出的数据序列总长度为1020字节（即1020个符号），此时将其中的前24字节移除，仅保留后996字节（含868字节的编码后RS码信息位和128字节的RS码校验位），用于在实际物理信道中传输。

#### RS译码器方案设计

RS码的译码的算法主要有两种：时域译码算法和频域译码算法。在这两种算法的基础上．后来又派生出了一些修正算法或快速算法。由于频域译码算法在实现上需要更多的硬件资源，因而本文采用时域译码算法来实现RS(255,223)译码器。RS译码器主要包括伴随式计算、计算错误位置和错误值多项式、钱搜索计算错误位置、福尼算法计算错误值、模二和计算解码输出5个主要部分，其整体结构如图所示。

![](media/image64.png){width="5.060325896762905in"
height="1.208860454943132in"}

图 68 RS译码器结构

（1）伴随式计算

定义伴随多项式为

$$S(x) = S_{32}x^{32} + S_{31}x^{31} + ... + S_{1}x$$

其系数为

$$S_{i} = (...(((R_{n - 1}\alpha^{i} + R_{n - 2})\alpha^{i} + R_{n - 3})\alpha^{i} + ...)\alpha^{i} + R_{0})$$

式中：$n = 255,i = 1,2,3,...,32,R_{0}\sim R_{254}$为译码输入。电路结构如所图所示，首先将$R_{0}\sim R_{254}$写到RAM内，接下来RAM读地址*rd_addr*累加1，将数据读出；当数据全部读出后refresh信号为高，读地址清零。这样只使用了一个乘法器，就串行得到了伴随式系数$S_{1}\sim S_{32}$。

![](media/image65.png){width="3.8125in" height="1.75in"}

图 69 伴随式计算电路

（2）关键方程求解

在RS译码器设计中，关键方程的求解过程以计算错误位置和错误值多项式最为重要，也是最困难的一步。对于这一模块的计算，目前比较成熟的方法有两种：BM算法和Euclid算法。在BM算法中，伴随式是串行输入的，虽然可节省一定的存储空间，但逻辑控制比较复杂，导致最终占用的逻辑单元比较多；Euclid算法中的伴随式是并行输入的，硬件实现便于控制，占用的逻辑单元也比较少，这里采用该算法实现RS(255,223)译码。在该算法中，主要是实现多项式的除法和乘法运算。为了节省资源，数据输入与刷新采用并行机制，把所有并行乘法运算改为串行实现，这样多项式除法器只使用一个有限域乘法器和求逆器，多项式乘法器也只使用了一个有限域乘法器，在保证运算速度的同时也最大限度地节省了硬件资源。

多项式除法器的实现如下图所示。

![](media/image66.png){width="4.333333333333333in" height="2.4375in"}

图 70 多项式除法器流程图

用两组固定长度的寄存器来存放$A(x)$和$B(x)$的系数，通过并串转换来串行得到$r(x)$除了第一次初始化时需给出$A(x)$和$B(x)$的阶数外，以后每次它们的阶数都由$r(x)$的阶数直接或间接得到，而由于每次$r(x)$是串行得到的，其阶数能通过判断上次$r(x)$的阶数*degr*以及串行得到$r(x)$求得，硬件电路图如下图所示。

![](media/image67.png){width="4.526388888888889in"
height="1.6513888888888888in"}

图 71 求$\mathbf{r(x)}$阶数电路图

多项式乘法器如下图所示，将多项式除法运算的结果*q*和*deg(q)*实时输入多项式乘法器$A(x)$赋初值1，$B(x)$赋初值0，$A(x)$乘上*q*串行实现。每完成一次除法运算，多项式除法器模块给此模块一个控制信号$A(x)$与$B(x)$互换。除法进行时GATE关闭，输出无效；当除法迭代结束时，多项式乘法器模块的控制信号控制GATE打开，输出有效。

![](media/image68.png){width="3.84375in" height="2.0055555555555555in"}

图 72 多项式乘法器流程图

（3）钱搜索计算错误位置和福尼算法计算错误值

通过计算错误位置多项式$\sigma(x)$在$GF(2^{8})$中所有元素的值从而找出错误位置多项式的根，即依次把$\alpha^{- i}(0 \leq i \leq 254)$代入位置多项式

$$\sigma(x) = \sum_{i = 0}^{e}{\sigma_{i}x^{i}}$$

式中：$e \leq 16$，是实际错误个数。若$\sigma(\alpha^{- i}) = 0$，则第$i$位是一个错误位置，这样便找出了错误位置。

计算错误值的福尼算法公式为

$$Y_{i} = \frac{\omega(x_{i}^{- 1})}{x_{i}^{- 1}\sigma^{'}(x_{i}^{- 1})}$$

式中$x_{i}$是错误位置对应的本原形式；$\sigma(x)$和$\omega(x)$分别是错误位置多项式和错误值多项式，其中

$$x\sigma^{'}(x) = x(\sigma_{1} + \sigma_{3}x^{2} + ...) = \sigma_{1}x + \sigma_{3}x^{3} + ...$$

即为钱搜索电路的奇次项移位寄存器内容的累加，可采用与钱搜索类似的电路实现。如下图所示，使用一个RAM存放中间结果，刷新RAM时GATE关闭；迭代运算结束后GATE打开，与1模二加。其中虚线框中是福尼算法中求分母的功能块，同时注意钱搜索和福尼算法分别采用$\sigma_{i}$和$\omega_{i}$初始化D触发器。

![](media/image69.png){width="4.40625in" height="2.1041666666666665in"}

图 73 钱搜索/福尼算法电路

### LDPC编译码方案

#### 生成矩阵与校验矩阵

(8176,7154)LDPC码的校验矩阵是一个由$511 \times 511$循环移位子矩阵构成的$2 \times 16$块矩阵，校验矩阵维度是$1022 \times 8176$。由于循环移位子矩阵$A_{i,j}(i = 1,2;j = 1,\ldots,16)$的行重和列重均为2，因此校验矩阵的行重为32，列重为4。

![](media/image70.png){width="6.220833333333333in"
height="0.5048611111111111in"}

图 74 (8176,7154)LDPC码校验矩阵结构

A~i,j~是511×511的循环矩阵。每个循环矩阵的行重都为2,即每行有2个"1"。因此,校验矩阵每行的行重为2×16=32。表4的第2列给出了每个循环矩阵第1行中"1"的位置，下边的每一行由上一行循环右移1位得到，"1\"有511个可能的位置，位置数从0到510；表4的第3列给出了校验矩阵中"1"的绝对位置，有8176个可能的位置，位置数从0到8175。

(8176,7154)LDPC编码的生成矩阵如下所示，其中$\mathbf{I}$为$511 \times 511$的单位矩阵，$\mathbf{0}$为$511 \times 511$的零矩阵，$B_{i,j}(i = 1,\ldots,14;j = 1,2)$是$511 \times 511$的循环移位矩阵。

![](media/image71.png){width="2.1896609798775155in"
height="1.3258891076115487in"}

图 75 (8176,7154)LDPC码生成矩阵

其中生成矩阵的循环子阵列表如下。

表 8 生成矩阵的循环子阵列表

+-------+--------------------------------------------------------------+
| 循环  | 循环子阵的第一行                                             |
| 子阵  |                                                              |
+=======+==============================================================+
| B     | 55BF56CC                                                     |
| ~1,1~ | 55283DFEEFEA8C8CFF04E1EBD9067710988E25048D67525426939E2068D2 |
|       | DC6FCD2F822BEB6BD96C8A76F4932AAE9BC53AD20A2A9C86BB461E43759C |
+-------+--------------------------------------------------------------+
| B     | 6855AE0                                                      |
| ~1,2~ | 8698A50AA3051768793DC238544AF3FE987391021AAF6383A6503409C3CE |
|       | 71A80B3ECE12363EE809A01D91204F1811123EAB867D3E40E8C652585D28 |
+-------+--------------------------------------------------------------+
| B     | 62B21CF0                                                     |
| ~2,1~ | AEE0649FA67B7D0EA6551C1CD194CA77501E0FCF8C85867B9CF679C18BCF |
|       | 7939E10F8550661848A4E0A9E9EDB7DAB9EDABA18C168C8E28AACDDEAB1E |
+-------+--------------------------------------------------------------+
| B     | 64B71F48                                                     |
| ~2,2~ | 6AD57125660C4512247B229F0017BA649C6C11148FB00B70808286F1A979 |
|       | 0748D296A593FA4FD2C6D7AAF7750F0C71B31AEE5B400C7F5D73AAFO0710 |
+-------+--------------------------------------------------------------+
| B     | 681A8E51                                                     |
| ~3,1~ | 420BD8294ECE13E491D618083FFBBA830DB5FAF330209877D801F92B5E07 |
|       | 117C57E75F6F0D873B3E520F21EAFD78C1612C6228111A369D5790F5929A |
+-------+--------------------------------------------------------------+
| B     | 04DF1DD7                                                     |
| ~3,2~ | 7F1C20C1FB570D7DD7A1219EAECEA4B2877282651B0FFE713DF338A63263 |
|       | BC0E324A87E2DC1AD64C9F10AAA585ED6905946EE167A73CF04AD2AF9218 |
+-------+--------------------------------------------------------------+
| B     | 35951FEE                                                     |
| ~4,1~ | 6F20C902296C9488003345E6C5526C5519230454C556B8A04FCODC642D68 |
|       | 2D94B4594B5197037DF15B5817B26F16D0A3302C09383412822F6D2B234E |
+-------+--------------------------------------------------------------+
| B     | 7681CF7F                                                     |
| ~4,2~ | 278380E28F1262B22F40BF3405BFB92311A8A34D084C086464777431DBFD |
|       | DD2E82A2E6742BAD6533B51B2BDEE0377E9F6E63DCA0B0F1DF97E73D5CD8 |
+-------+--------------------------------------------------------------+
| B     | 188157AE                                                     |
| ~5,1~ | 41830744BAE0ADA6295E08B79A44081E111F69BBE7831D07BEEBF76232E0 |
|       | 65F752D4F218D39B6C5BF20AE5B8FF172A7F1F680E6BF5AAC3C4343736C2 |
+-------+--------------------------------------------------------------+
| B     | 5D                                                           |
| ~5,2~ | 80A6007C175B5C0DD88A442440E2C29C6A136BBCE0D95A58A83B48CA0E74 |
|       |                                                              |
|       | 74E947                                                       |
|       | 6C92E33D164BFF943A61CE1031DFF441B0B175209B498394F4794644392E |
+-------+--------------------------------------------------------------+
| B     | 60CD1F1C                                                     |
| ~6,1~ | 282A1612657E8C7C1420332CA245C0756F78744C807966C3E1326438878B |
|       | D2CCC83388415A612705AB192B3512EEF0D95248F7B73E5B0F412BF76DB4 |
+-------+--------------------------------------------------------------+
| B     | 434B697B                                                     |
| ~6,2~ | 98C9F3E48502C8DBD891D0A0386996146DEBEF11D4B833033E05EDC28F80 |
|       | 8F25E8F314135E6675B7608B66F7FF3392308242930025DDC4BB65CD7B6E |
+-------+--------------------------------------------------------------+
| B     | 76685512                                                     |
| ~7,1~ | 5CFDC804DAF8DBE3660E8686420230ED4E049DF11D82E357C54FE256EA01 |
|       | F5681D95544C7A1E32B7C30A8E6CF5D0869E754FFDE6AEFA6D7BE8F1B148 |
+-------+--------------------------------------------------------------+
| B     | 222975D3                                                     |
| ~7,2~ | 25A487FE560A6D146311578D9C5501D28BC0A1FB48C9BDA173E869133A3A |
|       | A9506C42AE9F466E85611FC5F8F74E439638D66D2F00C682987A96D8887C |
+-------+--------------------------------------------------------------+
| B     | 14B5F98E                                                     |
| ~8,1~ | 8D55FC8E9B4EE453C6963E052147A857AC1E08675D99A308E7269FAC5600 |
|       | D7B155DE8CB1BAC786F45B46B523073692DE745FDF10724DDA38FD093B1C |
+-------+--------------------------------------------------------------+
| B     | 1B71AFFB                                                     |
| ~8,2~ | 8117BCF8B5D002A99FEEA49503C0359B056963FE5271140E626F6F8FCE9F |
|       | 29B37047F9CA89EBCE760405C6277F329065DF21AB3B779AB3E8C8955400 |
+-------+--------------------------------------------------------------+
| B     | 0008B4E8                                                     |
| ~9,1~ | 99E5F7E692BDCE69CE3FAD997183CFAEB2785D0C3D9CAE510316D4BD65A2 |
|       | A06CBA7F4E4C4A80839ACA81012343648EEA8DBBA2464A68E115AB3F4034 |
+-------+--------------------------------------------------------------+
| B     | 5B7FE680                                                     |
| ~9,2~ | 8A10EA42FEF0ED9B41920F82023085C106FBBC1F56B567A14257021BC5FD |
|       | A60CBA05B08FAD6DC3B0410295884C7CCDE0E56347D649DE6DDCEEBOC95E |
+-------+--------------------------------------------------------------+
| B~    | 5E9B2B33                                                     |
| 10,1~ | EF82D0E64AA2226D6A0ADCD179D5932EE1CF401B336449D0FF775754CA56 |
|       | 650716E61A43F963D59865C7F017F53830514306649822CAA72C152F6EB2 |
+-------+--------------------------------------------------------------+
| B~    | 2CD8140C                                                     |
| 10,2~ | 8A37DE0D0261259F63AA2A420A8F81FECB661DBA5C62DF6C817B4A61D2BC |
|       | 1F068A50DFD0EA8FE1BD387601062E2276A4987A19A70B460C54F215E184 |
+-------+--------------------------------------------------------------+
| B~    | 06F1FF24                                                     |
| 11,1~ | 9192F2EAF063488E267EEE994E7760995C4FA6FFA0E4241825A7F5B65C74 |
|       | FB16AC4C891BC008D33AD4FF97523EE5BD14126916E0502FF2F8E4A07FC2 |
+-------+--------------------------------------------------------------+
| B~    | 65287840                                                     |
| 11,2~ | D00243278F41CE1156D1868F24E02F91D3A1886ACE906CE741662B40B4EF |
|       | DFB90F76C1ADD884D920AFA8B3427EEB84A759FA02E00635743F50B942F0 |
+-------+--------------------------------------------------------------+
| B~    | 4109DA2A                                                     |
| 12,1~ | 24E41B1F375645229981D4B7E88C36A12DAB64E91C764CC43CCEC188EC8C |
|       | 5855C8FF488BB91003602BEF43DBEC4A621048906A2CDC5DBD4103431DB8 |
+-------+--------------------------------------------------------------+
| B12,2 | 2185E3BC                                                     |
|       | 7076BA51AAD6B199C8C60BCD70E8245B874927136E6D8DD527DF0693DC10 |
|       | A1C8E51B5BE93FF7538FA138B335738F4315361ABF8C73BF40593AE22BE4 |
+-------+--------------------------------------------------------------+
| B~    | 22884577                                                     |
| 13,1~ | 5A262505B47288E065B23B4A6D78AFBDDB2356B392C692EF56A35AB4AA27 |
|       | 767DE72F058C6484457C95A8CCDD0EF225ABA56B7657B7F0E947DC17F972 |
+-------+--------------------------------------------------------------+
| B~    | 2630C6F7                                                     |
| 13,2~ | 9878E50CF5ABD353A6ED80BEACC7169179EA57435E44411BC7D566136DFA |
|       | 983019F3443DE8E4C60940BC4E31DCEAD514D755AF95A622585D69572692 |
+-------+--------------------------------------------------------------+
| B~    | 7273E834                                                     |
| 14,1~ | 2918E097B1C1F5FEF32A150AEF5E11184782B5BD5A1D8071E94578BOAC72 |
|       | 2D7BF49E8C78D391294371FFBA7B88FABF8CC03A62B940CE60D669DFB7B6 |
+-------+--------------------------------------------------------------+
| B~    | 087EA120                                                     |
| 14,2~ | 42793307045B283D7305E93D8F74725034E77D25D3FF043ADC5F8B5B186D |
|       | B70A968A816835EFB575952EAE7EA4E76DF0D5F097590E1A2A978025573E |
+-------+--------------------------------------------------------------+

同理，当信息位长度*k*=16384时，根据码率4/5，码率2/3，码率1/2可以分别给出LDPC(20480,16384)，LDPC(24576,16384)，LDPC(32768,16384)所对应的码长，如下表所示。

表 9 *k*=16384长码

  -----------------------------------------------------------------------
  信息位长度*k*     码长*n*                             
  ----------------- ----------------- ----------------- -----------------
                    码率1/2           码率2/3           码率4/5

  16384             32768             24576             20480
  -----------------------------------------------------------------------

校验矩阵H由M×M子矩阵构成，其中子矩阵的M如下表所示。

表 10 子矩阵M值

  -----------------------------------------------------------------------
  信息位长度*k*     子矩阵*M*                           
  ----------------- ----------------- ----------------- -----------------
                    码率1/2           码率2/3           码率4/5

  1024              512               256               128

  4096              2048              1024              512

  16384             8192              4096              2048
  -----------------------------------------------------------------------

码率为1/2的编码的H矩阵规定如下，

![](media/image72.png){width="3.7580719597550307in"
height="0.7341852580927384in"}

其中$I_{M}$和$0_{M}$分别表示*M*×*M*单位矩阵和零矩阵，$\Pi_{1}$到$\Pi_{8}$是置换矩阵。LDPC(20480,16384)，LDPC(24576,16384)的H矩阵通过增加列数和置换矩阵来定义。由于LDPC(20480,16384)不能通过LDPC(24576,16384)直接得出，因此也定义了中间LDPC编码码率为3/4的H矩阵。如下：

![](media/image73.png){width="3.4464370078740156in"
height="0.763999343832021in"}

![](media/image74.png){width="3.5206539807524058in"
height="0.7647911198600175in"}

![](media/image75.png){width="3.1865080927384075in"
height="0.7540168416447944in"}

置换矩阵$\Pi_{k}$在行*i*和列$\pi_{k}(i)$中存在非零元素，其中*i*∈{0，\...，M-1}。

![](media/image76.png){width="4.328470034995625in"
height="0.3891174540682415in"}

其中函数$\theta_{k}$和$\phi_{k}$(*j*,*M*)的定义详见以下表。这些表格中的数值通过$\phi_{k}$(*j*,*M*)推导。

表 11
$\mathbf{\phi}_{\mathbf{k}}$(0,M)和$\mathbf{\phi}_{\mathbf{k}}$(1,M)

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  k    $$\mathbf{\theta}_{\mathbf{k}}$$   $\mathbf{\phi}_{\mathbf{k}}$(0,*M*)                                                                                      $\mathbf{\phi}_{\mathbf{k}}$(1,*M*)                                                                                
  ---- ---------------------------------- ------------------------------------------------------------------------------------ ---- ----- ----- ----- ----- ------ ------------------------------------------------------------------------------------ ---- ----- ----- ----- ------ ------
                                          *M*=$\mathbf{2}^{\mathbf{7}}\mathbf{\  \cdot \cdot \cdot}\mathbf{2}^{\mathbf{13}}$                                       *M*=$\mathbf{2}^{\mathbf{7}}\mathbf{\  \cdot \cdot \cdot}\mathbf{2}^{\mathbf{13}}$                                 

  1    3                                  1                                                                                    59   16    160   108   226   1148   0                                                                                    0    0     0     0     0      0

  2    0                                  22                                                                                   18   103   241   126   618   2032   27                                                                                   32   53    182   375   767    1822

  3    1                                  0                                                                                    52   105   185   238   404   249    30                                                                                   21   74    249   436   227    203

  4    2                                  26                                                                                   23   0     251   481   32    1807   28                                                                                   36   45    65    350   247    882

  5    2                                  0                                                                                    11   50    209   96    912   485    7                                                                                    30   47    70    260   284    1989

  6    3                                  10                                                                                   7    29    103   28    950   1044   1                                                                                    29   0     141   84    370    957

  7    0                                  5                                                                                    22   115   90    59    534   717    8                                                                                    44   59    237   318   482    1705

  8    1                                  18                                                                                   25   30    184   225   63    873    20                                                                                   29   102   77    382   273    1083

  9    0                                  3                                                                                    27   92    248   323   971   364    26                                                                                   39   25    55    169   886    1072

  10   1                                  22                                                                                   30   78    12    28    304   1926   24                                                                                   14   3     12    213   634    354

  11   2                                  3                                                                                    43   70    111   386   409   1241   4                                                                                    22   88    227   67    762    1942

  12   0                                  8                                                                                    14   66    66    305   708   1769   12                                                                                   15   65    42    313   184    446

  13   2                                  25                                                                                   46   39    173   34    719   532    23                                                                                   48   62    52    242   696    1456

  14   3                                  25                                                                                   62   84    42    510   176   768    15                                                                                   55   68    243   188   413    1940

  15   0                                  2                                                                                    44   79    157   147   743   1138   15                                                                                   39   91    179   1     854    1660

  16   1                                  27                                                                                   12   70    174   199   759   965    22                                                                                   11   70    250   306   544    1661

  17   2                                  7                                                                                    38   29    104   347   674   141    31                                                                                   1    115   247   397   864    587

  18   0                                  7                                                                                    47   32    144   391   958   1527   3                                                                                    50   31    164   80    82     708

  19   1                                  15                                                                                   1    45    43    165   984   505    29                                                                                   40   121   17    33    1009   1466

  20   2                                  10                                                                                   52   113   181   414   11    1312   21                                                                                   62   45    31    7     437    433

  21   0                                  4                                                                                    61   86    250   97    413   1840   2                                                                                    27   56    149   447   36     1345

  22   1                                  19                                                                                   10   1     202   158   925   709    5                                                                                    38   54    105   336   562    867

  23   2                                  7                                                                                    55   42    68    86    687   1427   11                                                                                   40   108   183   424   816    1551

  24   1                                  9                                                                                    7    118   177   168   752   989    26                                                                                   15   14    153   134   452    2041

  25   2                                  26                                                                                   12   33    170   506   867   1925   9                                                                                    11   30    177   152   290    1383

  26   3                                  17                                                                                   2    126   89    489   323   270    17                                                                                   18   116   19    492   778    1790
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

表 12
$\mathbf{\phi}_{\mathbf{k}}$(2,*M*)和$\mathbf{\phi}_{\mathbf{k}}$(3,*M*)

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  k    $$\mathbf{\theta}_{\mathbf{k}}$$   $\mathbf{\phi}_{\mathbf{k}}$(2,M)                                                                                      $\mathbf{\phi}_{\mathbf{k}}$(3,M)                                                                               
  ---- ---------------------------------- ---------------------------------------------------------------------------------- ---- ----- ----- ----- ----- ------ ---------------------------------------------------------------------------------- ---- ----- ----- ----- ----- ------
                                          M=$\mathbf{2}^{\mathbf{7}}\mathbf{\  \cdot \cdot \cdot}\mathbf{2}^{\mathbf{13}}$                                       M=$\mathbf{2}^{\mathbf{7}}\mathbf{\  \cdot \cdot \cdot}\mathbf{2}^{\mathbf{13}}$                                

  1    3                                  0                                                                                  0    0     0     0     0     0      0                                                                                  0    0     0     0     0     0

  2    0                                  12                                                                                 46   8     35    219   254   318    13                                                                                 44   35    162   312   285   1189

  3    1                                  30                                                                                 45   119   167   16    790   494    19                                                                                 51   97    7     503   554   458

  4    2                                  18                                                                                 27   89    214   263   642   1467   14                                                                                 12   112   31    388   809   460

  5    2                                  10                                                                                 48   31    84    415   248   757    15                                                                                 15   64    164   48    185   1039

  6    3                                  16                                                                                 37   122   206   403   899   1085   20                                                                                 12   93    11    7     49    1000

  7    0                                  13                                                                                 41   1     122   184   328   1630   17                                                                                 4    99    237   185   101   1265

  8    1                                  9                                                                                  13   69    67    279   518   64     4                                                                                  7    94    125   328   82    1223

  9    0                                  7                                                                                  9    92    147   198   477   689    4                                                                                  2    103   133   254   898   874

  10   1                                  15                                                                                 49   47    54    307   404   1300   11                                                                                 30   91    99    202   627   1292

  11   2                                  16                                                                                 36   11    23    432   698   148    17                                                                                 53   3     105   285   154   1491

  12   0                                  18                                                                                 10   31    93    240   160   777    20                                                                                 23   6     17    11    65    631

  13   2                                  4                                                                                  11   19    20    454   497   1431   8                                                                                  29   39    97    168   81    464

  14   3                                  23                                                                                 18   66    197   294   100   659    22                                                                                 37   113   91    127   823   461

  15   0                                  5                                                                                  54   49    46    479   518   352    19                                                                                 42   92    211   8     50    844

  16   1                                  3                                                                                  40   81    162   289   92    1177   15                                                                                 48   119   128   437   413   392

  17   2                                  29                                                                                 27   96    101   373   464   836    5                                                                                  4    74    82    475   462   922

  18   0                                  11                                                                                 35   38    76    104   592   1572   21                                                                                 10   73    115   85    175   256

  19   1                                  4                                                                                  25   83    78    141   198   348    17                                                                                 18   116   248   419   715   1986

  20   2                                  8                                                                                  46   42    253   270   856   1040   9                                                                                  56   31    62    459   537   19

  21   0                                  2                                                                                  24   58    124   439   235   779    20                                                                                 9    127   26    468   722   266

  22   1                                  11                                                                                 33   24    143   333   134   476    18                                                                                 11   98    140   209   37    471

  23   2                                  11                                                                                 18   25    63    399   542   191    31                                                                                 23   23    121   311   488   1166

  24   1                                  3                                                                                  37   92    41    14    545   1393   13                                                                                 8    38    12    211   179   1300

  25   2                                  15                                                                                 35   38    214   277   777   1752   2                                                                                  7    18    41    510   430   1033

  26   3                                  13                                                                                 21   120   70    412   483   1627   18                                                                                 24   62    249   320   264   1606
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

结合以上两表，编码方案共28种，每种对应码率*r*={1/2,2/3,3/4,4/5}其中一种，*M*取自上述集合。根据不同码率采用\~1dB间隔、不同长度使用0.6dB间隔，最终选取其中9种。对此构建的H矩阵，删除最后*M*个编码符号。以（*n*=1280，*k*=1024）码率-4/5编码的校验矩阵为例，其蓝色线条表示非零循环元素，网格线标示结构。次要网格线间隔为*m*单位，主网格线（未显示）间距*M*=4*m*。

![](media/image77.jpeg){width="5.79375in" height="1.8631944444444444in"}

图 76 用于（*n*=1280，*k*=1024）4/5码率编码的H矩阵

#### LDPC编码设计方案

假设被发送的信息序列为$\mathbf{d}$，则编码器输出的码字$\mathbf{c = d \bullet G =}\left\lbrack \mathbf{d} \middle| \mathbf{p} \right\rbrack\mathbf{=}\left\lbrack \mathbf{d} \middle| \mathbf{p}_{\mathbf{1}}\mathbf{,}\mathbf{p}_{\mathbf{2}} \right\rbrack$。其中，$\mathbf{p}$表示LDPC编码校验位，$\mathbf{p}_{\mathbf{1}}$表示第1\~511个校验比特，$\mathbf{p}_{\mathbf{2}}$表示第512\~1022个校验比特。利用$\mathbf{G}$矩阵的准循环特性，我们能方便地进行快速编码。编码过程中可将信息序列分为14段，即$\mathbf{d =}\left\lbrack \mathbf{d}_{\mathbf{1}}\mathbf{,}\mathbf{d}_{\mathbf{2}}\mathbf{,\ldots,}\mathbf{d}_{\mathbf{14}} \right\rbrack$。校验位$\mathbf{p}$可由下式计算得到：

![](media/image78.png){width="2.206441382327209in"
height="2.0516721347331583in"}

利用生成矩阵可分块的特性，校验位$\mathbf{p}_{\mathbf{i}}\left( \mathbf{i = 1,2} \right)$可由下式计算得到：

![](media/image79.wmf){width="1.8914162292213472in"
height="1.1829265091863517in"}

式中，$\oplus$表示对两个向量进行按位模2相加运算。编码器的实现方案如下图所示，信息序列经接收缓存后，分14段并行输出。这14路并行输出的信息序列，送入两个子编码器，分别完成校验位$\mathbf{p}_{\mathbf{1}}$和$\mathbf{p}_{\mathbf{2}}$的计算，即$\mathbf{p}_{\mathbf{1}}$和$\mathbf{p}_{\mathbf{2}}$的计算是并行完成的。校验位计算完成后，将编码结果进行缓存并按照接口要求进行并串转换后输出即可。

![](media/image80.emf){width="3.8652777777777776in"
height="1.8590277777777777in"}

图 77 LDPC编码器实现框图

下面重点介绍$\mathbf{p}_{\mathbf{i}}\left( \mathbf{i = 1,2} \right)$编码器的实现方式。在计算$\mathbf{p}_{\mathbf{i}}$的过程中，可将$\mathbf{d}_{k}\mathbf{B}_{k,i}(k = 1,\ldots,14)$的计算并行进行，如下图所示：

![](media/image81.emf){width="4.506944444444445in"
height="2.6194444444444445in"}

图 78 校验序列$\mathbf{p}_{\mathbf{i}}$计算的实现方案

根据子矩阵$\mathbf{B}_{k,i}(k = 1,\ldots,14;i = 1,2)$的准循环特性，我们能方便地进行快速编码。分量编码器1\~14分别完成$\mathbf{d}_{k}\mathbf{B}_{k,i}(k = 1,\ldots,14)$的计算，对分量编码器的输出进行按位模2相加即可得到校验序列$\mathbf{p}_{\mathbf{i}}$。

分量编码器主要由移位寄存器、加法器和累加器构成，因此也被称为移位寄存累加编码器，其实现结构如下图所示。编码开始后的第一个时钟周期，循环移位子矩阵$\mathbf{B}_{k,i}$的第一行$\mathbf{b}_{k,i}$被加载入511位的移位寄存器中，分段后的信息序列$\mathbf{d}_{i}(i = 1,\ldots,14)$开始输入。之后每一个时钟，移位寄存器循环移一位，同时输入1比特信息序列。其中，校验序列寄存器记录的是信息比特和子矩阵$\mathbf{B}_{k,i}$之积的累加。完成一次分量编码$\mathbf{d}_{k}\mathbf{B}_{k,i}(k = 1,\ldots,14)$只需要大约511个时钟周期，完成14个分量编码器计算结果的累加需要4个时钟周期。因此，将$\mathbf{p}_{\mathbf{1}}$和$\mathbf{p}_{\mathbf{2}}$的计算过程并行进行，同时将分量编码器的计算完全并行的话，完成一次LDPC编码过程仅需要大约515个时钟周期。

![](media/image82.emf){width="4.742361111111111in"
height="3.1666666666666665in"}

图 79 分量编码器实现框图

根据以上设计方案，可以得出：完成一次LDPC编码过程需要大约515个时钟周期，预定FPGA工作时钟为200MHz，那么LDPC编码耗时为$2.575\mu s$。信息速率为2.5Gbps时，一帧数据的时间长度约为$8176/2.5G = 3.264\mu s$。对QPSK调制5Gbps而言，一帧数据时间长的约为$8176/5G = 1.632\mu s$，此时单路LDPC编码吞吐量不够，而200MHz的工作频率以相对较高，难以通过提高工作频率提高吞吐量，因此采用提高并行量来满足指标需求，即同时进行两路LDPC编码，使得一帧数据的平均编码时间为1.2875$\mu s$，满足5Gbps吞吐需求。

#### LDPC译码设计方案

（1）LDPC译码算法方案

LDPC的译码算法主要有概率BP译码算法、对数似然比LLR（Log Likely
Rate）BP译码算法、最小和译码算法、归一化最小和译码算法（Normalized
Min-sum
Algorithm，NMSA）等。硬件实现时，最小和算法只需比较运算和加法操作，极大地降低了计算复杂度，但也带来了译码性能的损失。为了降低性能损失，NMSA是对最小和算法的改进，其实现复杂度与最小和算法相当，但可获得接近BP算法的性能。

为了方便描述，首先引入下列符号。$R_{j}$表示与校验节点$f_{j}$相连的变量节点的集合；$C_{i}$表示与变量节点$X_{i}$相连的校验节点的集合；$R_{j/i} = R_{j}\backslash i$表示集合$R_{j}$中去掉变量节点$X_{i}$；$C_{i/j} = C_{i}\backslash j$表示集合$C_{i}$中去掉校验节点$f_{j}$。归一化最小和译码算法可描述为如下步骤：

1.  初始化

乘性修正最小和译码算法的初始化软信息$y_{i}/\sigma^{2}$，$\sigma^{2}$的影响可以忽略不计，初始化软信息变为$y_{i}$，因此不需要对信道估计。

$L\left( q_{i,j} \right) = L\left( p_{i}^{0} \right) = y_{i},i = 1,\ldots,n$

式中，$y_{i}$为接收软值。

2.  校验节点更新

$L\left( r_{ji}^{k} \right) = \eta \times \left( \prod_{i^{'} \in N(j)\backslash i}^{}{\alpha\left( q_{ji^{'}}^{k - 1} \right)} \right)\min_{i^{'} \in N(j)\backslash i}{\beta\left( q_{ji^{'}}^{k - 1} \right)}$

式中，$\alpha\left( q_{ji^{'}}^{k - 1} \right) = sign\left( q_{ji^{'}}^{k - 1} \right)$，$\beta\left( q_{ji^{'}}^{k - 1} \right) = \left| q_{ji^{'}}^{k - 1} \right|$。$\eta$是一个小于1的常数，$\eta$的取值可以根据不同的信噪比和迭代次数通过密度进化的分析方法来进行分析，也可以采用计算机仿真的方法来确定。通过仿真，可以得出$\eta$为0.8时可获得较好的性能。

3.  变量节点更新

$L\left( p_{i}^{k} \right) = L\left( p_{i}^{0} \right) + \sum_{j \in M(i)}^{}{L\left( r_{ji}^{k - 1} \right)}$

$L\left( q_{ji}^{k} \right) = L\left( p_{i}^{k} \right) - L\left( r_{ij}^{k - 1} \right)$

对每个变量节点i在计算完成后，对$L\left( p_{i}^{k} \right)$进行判决，如果$L\left( p_{i}^{k} \right) < 0$，则${\widehat{x}}_{i} = 1$，否则为0；如果$\widehat{x}H^{T} = 0$成立，则译码结束，否则跳到步骤2)直至满足校验等式或者达到最大迭代次数为止。

归一化的最小和译码算法实现复杂度较低，算法的运算量与最小和译码算法相当，但如果选取的归一化因子恰当，算法的性能可以逼近对数域的BP译码算法，是一种适于FPGA硬件实现的译码方案。

（2）准循环LDPC码的等价变换

LDPC译码器有串行、全并行和部分并行三种实现结构，其中串行译码器结构简单，但译码速度低，不适于高速译码器设计；全并行实现结构可实现高速译码，但实现复杂度很高，硬件资源消耗极大，不具备可行性；部分并行译码结构作为上述两种实现结构的折中，是一种切实可行的高速译码器实现结构。综合考虑译码算法和校验矩阵的结构特点，准循环LDPC码的译码可以采用部分并行的结构。硬件实现过程中，一个通常的挑战是有序处理大量存储器读写以防止存储器访问冲突，因为校验节点和变量节点同时处理的外消息必须同时读出或写入存储器。针对(8176,7154)LDPC编码，可利用码变换的方法，通过对准循环LDPC码的校验矩阵做行与列的重新排列得到一种块循环LDPC码。

研究发现，若组成准循环LDPC码校验矩阵的循环矩阵的阶数存在整数分解$b = b_{1}b_{2}$，且满足$\left( b_{1},b_{2} \right) = 1$，则可将其分解为：

$\mathbf{H}_{qc} = {diag}_{(c)}\{\mathbf{P}_{c}\} \bullet \mathbf{H}_{bqc} \bullet {diag}_{(t)}\{\mathbf{P}_{t}\}$

其中，${diag}_{(n)}\{ P_{n}\}$表示以$b \times b$阶矩阵$\mathbf{P}$为基本元素的$nb \times nb$阶块对角矩阵，而矩阵$\mathbf{H}_{bqc}$定义为：

![](media/image83.png){width="2.1158114610673664in"
height="1.2139096675415573in"}

$\mathbf{H}_{bqc}$是$c \times t$的$b \times b$阶近似块循环矩阵阵列，块循环矩阵$\mathbf{h}_{ij}(i = 1,\ldots,c;j = 1,\ldots,t)$则由循环矩阵$\mathbf{A}_{ij}$通过相同的行列置换得到。

循环矩阵具有的结构性质可以使得准循环LDPC码部分并行译码器具备简单的多路并行译码能力。当我们将块循环矩阵中的*b~2~*×*b~2~*循环矩阵看做一个元素时，$b \times b$块循环矩阵就退化为b1×b1阶循环矩阵，而块准循环校验矩阵就退化为准循环矩阵。将b2×b2阶分块循环子矩阵中b2个'1'对应的置信度消息存放在同一地址对应的存储单元内，一个时钟周期可以读取出b2个数据，用于完成b2行/列的校验节点更新/变量节点更新，经过节点运算单元输出更新了的b2个消息重新组合在一起后被写回到存储器的原先位置。这种译码方式在增加并行度的同时并不会造成造成存储器的访问冲突，而且只需要增加存储器的字长以支持并行处理b2×b2阶分块循环子矩阵对应的多个节点运算单元。

（3）部分并行译码器设计方案

(8176,7154)LDPC编码是一种有限几何准循环LDPC码，校验矩阵$\mathbf{H}$由2×16个大小为511×511的循环矩阵阵列构成。根据上一节的分析，我们可将b=511分解为$b_{1} = 73$，$b_{2} = 7$。与(8176,7154)码同理，深空标准给出的(20480,16384)、(24576,16384)、(32768,16384)三组准循环LDPC仍采用\"部分并行块循环\"架构。校验矩阵均由256×256循环子矩阵拼接而成：行重恒为16，列重保持4，仅阵列规模由16×80、32×96扩展至64×128。把b=256按256=16×16二次分解后，每个16×16子块被视为一个元素，整个矩阵遂退化为16×(5/6/8)的块循环阵列。

以(8176,7154)LDPC编码为例，通过将校验矩阵分解为块循环矩阵，可采用7路块并行的译码结构，其实现框图如下图所示：

![](media/image84.emf){width="6.173611111111111in"
height="4.145833333333333in"}

图 80 路块并行LDPC译码结构

译码器由存储地址生成模块、置信度信息存储器组、信道似然比存储器组、判决存储器组、2个校验节点更新组、16个变量节点更新组和译码比特输出模块组成。信道似然比存储器组用于存储信道似然比(内消息)，它是译码器的初始化信息，在对一帧初始化信息进行译码的过程中，迭代运算不断调用的初始化信息保持不变；判决存储器组用于存储译码判决输出结果。置信度信息存储器组则用于存储迭代译码过程中的中间计算结果(外信息)，由于511×511循环矩阵经变换成为73×73的块循环矩阵，每个子块7×7的循环矩阵，因此每个存储器的深度为73，存储器宽度为量化位宽的7倍。每个节点处理单元CFUG和VFUG分别包含7个变量节点消息更新功能模块(CFU)与7个变量节点消息更新功能模块(VFU)，因此每个节点处理单元CFUG和VFUG可同时完成7行或7列的消息更新。

节点运算功能模块有CFU和VFU两种，CFU用于校验节点更新，其功能单元分为符号与幅度两部分，符号部分可采用树状结构的XOR链实现，幅度部分则需要从一组置信度消息中找出最小值和次最小值。采用树状CFU实现结构，能以较小的代价实现高速流水处理。树状CFU实现结构包括两种基本单元，即2输入的CFU模块与级联模块，其实现原理如下图所示：

![](media/image85.emf){width="2.5360050306211726in"
height="2.3368416447944007in"}![](media/image86.emf){width="2.4228860454943133in"
height="2.563158355205599in"}

\(a\) 2输入CFU模块 (b) 级联模块

图 81 树状CFU实现结构图

本项目采取的LDPC编码行重为32，对应的CFU模块为32输入。一个32输入的CFU模块需要分五步实现，其中第一步包含16个2输入CFU模块，剩余4步分别需要8、4、2、1个级联模块。由于采用了级联流水线处理方式，每个CFU占用一个时钟周期完成一行的消息更新，从而每个节点处理单元CFUG在一个时钟周期内能够完成7行的消息更新。

VFU模块用于实现变量节点更新，本项目采用的LDPC编码校验矩阵的列重为4，其实现结构如下图所示：

![](media/image87.emf){width="4.348611111111111in"
height="2.907638888888889in"}

图 82 VFU 模块实现结构

变量节点更新过程中，首相将初始LLR信息与对应的四输入相加，取其符号位即为该次迭代后的判决输出结果；dout1\~dout4为变量更新结果，计算完成后重新写入置信度存储器中。同样，采用分集流水处理方式，每个VFU占用一个时钟周期完成一列的消息更新，从而每个节点处理单元VFUG在一个时钟周期内能够完成7行的消息更新。

（4）译码器吞吐量分析

这一部分针对上述的部分并行LDPC译码器的吞吐量进行初步分析。校验节点更新过程中，由于采用了两路CFUG并行结构，每个CFUG又包括7个CFU模块，其实现并行度可看作是14。完成校验矩阵1022行更新，需要大约1022/14=73个时钟周期。对应变量节点更新，采用了16路VFUG并行实现结构，每个VFUG包括7个VFU模块，其实现并行度为112。完成校验矩阵8176列更新，需要大约8176/112=73个时钟周期。考虑更新过程中的处理时延等因素，一次完整的迭代所消耗的时间大约为200个时钟周期。

采用NMSA译码算法，LLR取6bit量化位宽，中间变量取8bit位宽时，最大迭代次数为6即可满足编码增益的指标要求。因此，完成一帧译码共需占用大约1200个时钟周期。预期FPGA工作时钟为200MHz，则一帧译码耗时约为$6\mu s$。信息速率为2.5Gbps时，对应一个LDPC码帧长约为$3.264\mu s$，采用两个LDPC译码器交替工作。信息速率为5Gbps时，采用4个LDPC译码器交替工作。

### 编码增益分析

RS码与LDPC码的编码增益如下表所示。

  -----------------------------------------------------------------------------------------------
   序号   误码率     无编码       编码方式                                       
  ------ -------- ------------- ------------- ---------------- ----------------- ----------------
                                 RS(255,223)                    LDPC(8176,7154)  

                   Eb/N0（dB）   Eb/N0（dB）   编码增益（dB）     Eb/N0（dB）     编码增益（dB）

    1     10^-4^      8.40          5.90            2.5              3.72              4.68

    2     10^-5^      9.59          6.16            3.43             3.86              5.73

    3     10^-6^      10.53         6.38            4.15             3.93              6.60

    4     10^-7^      11.31         6.57            4.74             4.00              7.31
  -----------------------------------------------------------------------------------------------

  : 表 1 编码增益仿真结果

编码的误码率如下图所示。

![](media/image88.png){width="5.7665441819772525in"
height="4.354861111111111in"}

图 5 编码误码率仿真结果图

# 人机交互软件设计

控制交互模块具有系统参数配置功能、工作状态监测功能、星座图实时显示功能和误码率实时测试功能。用户可系统参数配置包括激光波长配置、通信速率配置、信道编码切换和光处理控制。用户可通过工作状态检测功能来对载波同步锁定状态、符号同步锁定状态、帧同步锁定状态和帧计数结果进行监测。星座图实时显示功能分有BPSK调制星座图测试界面和QPSK调制星座图测试界面。此外，本模块有误码率实时测试功能，提供译码前误码率数据与图表，译码前后误码率数据与图表。

![](media/image89.png){width="5.360416666666667in"
height="4.759722222222222in"}

图 92 控制交互模块

### 系统参数配置功能

系统参数设置界面设计如下图所示。用户在此界面上在测试前对系统进行控制信息配置，包括激光波长配置、通信速率配置、信道编码切换、光处理控制等功能。激光波长采用1550nm波段，具备A、B两种状态，与待测设备状态匹配；通信速率采用OOK调制，包括10Mbps、20Mbps速率档位，同时有BPSK调制，包括312.5Mbps、625Mbps、1.25Gbps、2.5Gbps速率档位和QPSK的5Gbps档位，分档独立可调；编码方式包括RS(255,223)、LDPC(8176,7154)、[LDPC(20480,16384)、LDPC(24576,16384)和LDPC(32768,16384)]{.mark}五种，可通过下拉选项进行编码方式切换，在测试过程中，根据不同的信道环境选择合适的编译码方式。光处理控制提供可调的发射激光功率设置，范围从毫瓦到瓦级。用户可设定精确的功率值，模拟激光器的输出能力，设置接收机的灵敏度。

![](media/image90.png){width="5.721925853018373in"
height="3.278740157480315in"}

图 93 通信速率参数配置

### 工作状态监测功能

工作状态监测功能用于实时监测信号状态。测试前可设置信号功率，频偏估计值，编码方式，发送速率，接收速率。当点击"开始记录"按钮时，发送端将开始发送固定的测试数据，模块将监测载波同步锁定状态、符号同步锁定状态、帧同步锁定状态、帧计数结果，并以表格的形式呈现。

![](media/image91.png){width="5.689583333333333in"
height="3.208160542432196in"}

图 94 状态监测

### 星座图实时显示功能

星座图实时显示功能用于显示调制方式即可以用图形直观地展示出不同调制方式下编码和符号的对应关系，并可以评估信号质量，验证信号生成的有效性。

![](media/image92.png){width="5.721668853893263in"
height="3.1842213473315835in"}

（a）BPSK调制星座图测试界面

![](media/image93.png){width="5.727272528433946in"
height="3.2374890638670166in"}

（b）QPSK调制星座图测试界面

图 95 星座图测试界面

### 误码率实时测试功能

误码率测试功能用于实时显示数据误码率。测试前可设置信号功率，频偏估计值，编码方式，发送速率，接收速率。当点击"开始记录"按钮时，发送端将开始发送固定的测试数据，在收到固定数据后，程序后台将收到的数据与本地相应的数据逐比特进行比较，实时计算并显示译码前误比特数，译码后误比特数，并按时间绘制译码前和译码后误比特率变化曲线图，用表格记录采样点数据。当再次点击"停止记录"按钮时，停止接收数据并保留显示文本，储存结果数据。

![](media/image94.png){width="5.684492563429571in"
height="3.1765824584426947in"}

（a）312.5Mbps误码率测试界面

![](media/image95.png){width="5.716578083989502in"
height="3.357976815398075in"}

（b）625Mbps误码率测试界面

![](media/image96.png){width="5.7625in" height="3.21998687664042in"}

（c）1.25Gbps误码率测试界面

![](media/image97.png){width="5.732620297462817in"
height="3.2051246719160105in"}

（d）2.5Gbps误码率测试界面

![](media/image98.png){width="5.700534776902887in"
height="3.1985958005249344in"}

（e）5Gbps误码率测试界面

图 96 误码率测试界面

# 技术指标分析

本章对激光通信处理原理样机的主要技术指标进行分析，分析其是否满足技术协议要求。

## 功能指标分析

### 信号产生与接收处理功能

#### 指标要求

具备RZ-OOK、PPM通信信号产生、接收处理功能。

#### 指标分析

综合信息处理与测量分系统的调制方式及速率包含高速模式和低速模式。高速模式中，上行采用16-PPM调制方式，时隙速率为311MHz，下行采用16-PPM调制，时隙速率为5GHz；低速模式中，上行采用16-PPM调制方式，时隙速率为10MHz（根据实际情况可调），下行采用16-PPM调制方式，时隙速率为10MHz（根据实际情况可调）。

16-PPM调制方式为单脉冲调制方式（LPPM），将4比特的二进制数据映射到16个等间隔时隙上，16个时隙中只有一个时隙出现脉冲信号。由于单脉冲位置调制映射是一一映射，每个4比特二进制数据有唯一的16-PPM符号与之对应，满足调制过程中的唯一性要求。

高速模式下上行PPM信号时隙速率为311MHz，对应波形如图6‑1所示；下行PPM信号时隙速率为5GHz，对应波形如图6‑2所示。低速模式下上下行PPM信号时隙速率均为10MHz，对应波形如图6‑3所示。

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\300m-xiao.bmp](media/image19.png){width="5.723716097987752in"
height="2.9583333333333335in"}

图6‑1

高速模式上行311MHz信号波形

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\5g-xiao.bmp](media/image56.png){width="5.708333333333333in"
height="2.9503816710411197in"}

图6‑2

高速模式下行5GHz信号波形

![D:\\科研工作\\2 激光测距 相关科研\\3 投标\\PPM示波器观察上行
下行发送信号
照片\\300m-da.bmp](media/image20.png){width="5.723719378827647in"
height="2.9583333333333335in"}

图6‑3

低速模式上下行10MHz信号波形

#### 符合情况

表7-1 信号产生与接收处理功能指标符合表

  -----------------------------------------------------------------------------------------------------------------------------------------------
  序号   指标项                   要求指标                                      设计指标                                                符合性
  ------ ------------------------ --------------------------------------------- ------------------------------------------------------- ---------
  2      信号产生与接收处理功能   具备RZ-OOK、PPM通信信号产生、接收处理功能。   样机具备RZ-OOK、PPM通信信号产生、接收处理功能。XXXXXX   符合

  -----------------------------------------------------------------------------------------------------------------------------------------------

### 通信及编译码功能

#### 指标要求

#### 指标分析

#### 符合情况

### 自闭环验证功能

#### 指标要求

#### 指标分析

#### 符合情况

### 信息传输功能

#### 指标要求

#### 指标分析

#### 符合情况

### 人机交互与显示功能

#### 指标要求

#### 指标分析

#### 符合情况

## 性能指标分析

### 调制方式性能

#### 指标要求

#### 指标分析

#### 符合情况

### 通信速率性能

#### 指标要求

#### 指标分析

#### 符合情况

### 编译码方式性能

#### 指标要求

#### 指标分析

#### 符合情况

### 调制信号幅度性能

#### 指标要求

调制信号：≥±2.5V。

#### 指标分析

#### 符合情况

### 信息传输性能

#### 指标要求

信息传输：视频流至少满足1080P实时传输。

#### 指标分析

#### 符合情况

### 通道使能性能

#### 指标要求

其他：采集通道使能，为协议控制。

#### 指标分析

#### 符合情况

## 接口指标分析

### 调制信号接口指标

#### 指标要求

调制信号接口为1路SMA-K，阻抗50R，单端接口。

#### 指标分析

#### 符合情况

### 接收信号接口指标

#### 指标要求

接收信号接口为1路高速10GHz采样率接口以及4路5GHz采样率接口，连接器均为SMA-K，阻抗50R单端接口。

#### 指标分析

#### 符合情况

# 设计指标符合表

表8-1 设计指标符合表

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  序号   指标项                                                                                                   要求指标                                    设计结果             符合性
  ------ ---------- --------------------------------------------------------------------------------------------- ------------------------------------------- -------------------- --------
  1      功能指标   信号产生与接收处理功能                                                                        具备RZ-OOK、PPM通信信号产生、接收处理功能                        符合

  2                 通信及编译码功能                                                                                                                                               符合

  3                                                                                                                                                                                符合

  4                                                                                                                                                                                符合

  5                                                                                                                                                                                符合

  6      性能指标                                                                                                                                                                  符合

  7                                                                                                                                                                                符合

  8                                                                                                                                                                                符合

  9                                                                                                                                                                                符合

  10                                                                                                                                                                               符合

  11                                                                                                                                                                               符合

  12     接口指标   调制信号接口为1路SMA-K，阻抗50R，单端接口                                                                                                                      符合

  13                接收信号接口为1路高速10GHz采样率接口以及4路5GHz采样率接口，连接器均为SMA-K，阻抗50R单端接口                                                                    符合
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# 结论

本项目针对SNSPD激光通信应用验证需求，研制激光通信处理原理样机。根据目前的设计结果，方案可行，能够满足技术协议要求的功能、性能指标，可据此进行投产。
